import{d as e,h as a,y as l,al as t,$ as o,a as s,w as i,i as n,o as r,e as c,s as u,g as d,t as m,ay as f,a4 as v,a6 as p,a5 as _,a0 as y,aI as N,a3 as g,aJ as b}from"./index-5U173LQ3.js";import{A as h}from"./aioveu-position.5P-apEWx.js";import{A as k}from"./aioveu-department.Ni2j20Wl.js";import{D as w}from"./dict.R0KYYCD_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=x(e({__name:"form",setup(e){const x=a("新增岗位"),I=a(void 0),j=a(!1),V=a(void 0),A=l({}),D=a([]),C=a([]),L=a(-1),F=a(-1);t((e=>{console.log("页面参数:",e),U(),E(),e.id?(I.value=Number(e.id),x.value="编辑岗位",O()):x.value="新增岗位",V.value=I.value}));const O=async()=>{if(I.value)try{j.value=!0;const e=await h.getFormData(I.value);if(Object.assign(A,e),A.deptName){const e=D.value.findIndex((e=>e.deptName===A.deptName));L.value=e}if(void 0!==A.positionLevel){const e=C.value.findIndex((e=>Number(e.value)===A.positionLevel));F.value=e}}catch(e){console.error("加载岗位数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{j.value=!1}},U=async()=>{try{const e=await k.getAllDepartmentOptions();Array.isArray(e)&&(D.value=e.map((e=>({deptId:Number(e.deptId),deptName:e.deptName}))))}catch(e){console.error("加载部门列表失败:",e),o({title:"加载部门列表失败",icon:"none"})}},E=async()=>{try{const e=await w.getDictItems("position_level");C.value=e||[]}catch(e){console.error("加载字典选项失败:",e),o({title:"加载选项失败",icon:"none"})}},J=e=>{const a=e.detail.value;L.value=a,D.value[a]&&(A.deptName=D.value[a].deptName)},$=e=>{const a=e.detail.value;F.value=a,C.value[a]&&(A.positionLevel=Number(C.value[a].value))},q=async()=>{if(z())try{N({title:"提交中..."});const e=V.value;e?(await h.update(e,A),o({title:"修改成功",icon:"success"})):(await h.add(A),o({title:"新增成功",icon:"success"})),g()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{b()}},z=()=>A.positionName?A.deptName?void 0!==A.positionLevel||(o({title:"请选择职级",icon:"none"}),!1):(o({title:"请选择所属部门",icon:"none"}),!1):(o({title:"请输入岗位名称",icon:"none"}),!1),B=()=>{g()};return(e,a)=>{const l=u,t=n,o=v,N=p,g=_,b=f,h=y;return r(),s(t,{class:"form-container"},{default:i((()=>[c(t,{class:"form-header"},{default:i((()=>[c(l,{class:"form-title"},{default:i((()=>[d(m(x.value),1)])),_:1})])),_:1}),c(b,{class:"form-body scroll-y","scroll-y":""},{default:i((()=>[c(t,{class:"form-item"},{default:i((()=>[c(l,{class:"form-label"},{default:i((()=>[d("岗位名称")])),_:1}),c(o,{type:"text",class:"form-input",placeholder:"请输入岗位名称",modelValue:A.positionName,"onUpdate:modelValue":a[0]||(a[0]=e=>A.positionName=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:i((()=>[c(l,{class:"form-label"},{default:i((()=>[d("所属部门")])),_:1}),c(N,{class:"form-picker",mode:"selector",range:D.value,"range-key":"deptName",value:L.value,onChange:J},{default:i((()=>[c(t,{class:"picker-view"},{default:i((()=>[d(m(L.value>=0?D.value[L.value].deptName:"请选择所属部门"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:i((()=>[c(l,{class:"form-label"},{default:i((()=>[d("职级")])),_:1}),c(N,{class:"form-picker",mode:"selector",range:C.value,"range-key":"label",value:F.value,onChange:$},{default:i((()=>[c(t,{class:"picker-view"},{default:i((()=>[d(m(F.value>=0?C.value[F.value].label:"请选择职级"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:i((()=>[c(l,{class:"form-label"},{default:i((()=>[d("岗位描述")])),_:1}),c(g,{class:"form-textarea",placeholder:"请输入岗位描述",modelValue:A.description,"onUpdate:modelValue":a[1]||(a[1]=e=>A.description=e)},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-footer"},{default:i((()=>[c(h,{class:"form-btn cancel",onClick:B},{default:i((()=>[d("取消")])),_:1}),c(h,{class:"form-btn confirm",onClick:q},{default:i((()=>[d("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-0f1a00ae"]]);export{I as default};
