import{d as s,y as e,k as o,a as r,o as a,w as t,v as p,b as n,f as l,n as i,i as m}from"./index-5U173LQ3.js";import{u as c,w as f}from"./wd-toast.BszgenSq.js";import{j as u,f as d,H as g,v as h,s as y,z as w}from"./wd-icon.CDbxLjoy.js";import{u as j}from"./useChildren.Crbe03ZE.js";import{f as v,F as b}from"./types.Prh_CF5p.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=k(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:v,setup(s,{expose:v}){const{show:k}=c("wd-form-toast"),_=s,{children:x,linkChildren:C}=j(b);let E=e({});function O(s){s?E[s]="":Object.keys(E).forEach((s=>{E[s]=""}))}return C({props:_,errorMessages:E}),o((()=>_.model),(()=>{_.resetOnChange&&O()}),{immediate:!0,deep:!0}),v({validate:async function(s){const e=[];let o=!0;const r=[],a=function(){const s=w(_.rules),e=x.map((s=>s.prop));return Object.keys(s).forEach((o=>{e.includes(o)||delete s[o]})),x.forEach((e=>{d(e.prop)&&d(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=u(s)?s:d(s)?[s]:[],p=t.length>0?t.reduce(((s,e)=>(a[e]&&(s[e]=a[e]),s)),{}):a;for(const n in p){const s=p[n],a=g(_.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!d(a)||""===a)){e.push({prop:n,message:t.message}),o=!1;break}if(t.pattern&&!t.pattern.test(a)){e.push({prop:n,message:t.message}),o=!1;break}const{validator:s,...p}=t;if(s){const l=s(a,p);h(l)?r.push(l.then((s=>{"string"==typeof s?(e.push({prop:n,message:s}),o=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),o=!1)})).catch((s=>{const r=d(s)?y(s)?s:s.message||t.message:t.message;e.push({prop:n,message:r}),o=!1}))):l||(e.push({prop:n,message:t.message}),o=!1)}}}return await Promise.all(r),function(s){const e=x.map((s=>s.prop)).filter(Boolean),o=s.filter((s=>s.message&&e.includes(s.prop)));o.length&&(o.sort(((s,o)=>e.indexOf(s.prop)-e.indexOf(o.prop))),"toast"===_.errorType?k(o[0].message):"message"===_.errorType&&o.forEach((s=>{E[s.prop]=s.message})))}(e),o&&(t.length?t.forEach(O):O()),{valid:o,errors:e}},reset:function(){O()}}),(s,e)=>{const o=m;return a(),r(o,{class:i(`wd-form ${s.customClass}`),style:l(s.customStyle)},{default:t((()=>[p(s.$slots,"default",{},void 0,!0),"toast"===_.errorType?(a(),r(f,{key:0,selector:"wd-form-toast"})):n("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-e513a788"]]);export{_};
