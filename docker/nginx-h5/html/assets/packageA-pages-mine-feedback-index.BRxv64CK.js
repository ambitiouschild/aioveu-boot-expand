import{d as e,h as s,y as a,a as l,b as o,o as t,w as i,e as r,i as u,a1 as n,p as c,f as d,n as p,C as m,ae as f,af as v,ag as _,l as y,k as b,c as h,F as w,r as g,v as k,q as C,g as x,t as F,s as T,u as j,ah as z,ai as P,aj as L,$ as D,ak as I,al as M,E,G as K,am as S,an as U,a3 as N}from"./index-5U173LQ3.js";import{_ as V}from"./wd-cell-group.CJNVuq-S.js";import{_ as $}from"./wd-textarea.Dx53q_ul.js";import{c as A,_ as R,j as G,b as B,m as H,a as O,x as q,y as X,z as J,g as Q,A as W,f as Y,B as Z,C as ee}from"./wd-icon.CDbxLjoy.js";import{u as se,w as ae}from"./wd-overlay.iGBdgU4M.js";import{_ as le}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{u as oe}from"./useTranslate.Kg86_MV8.js";import{_ as te}from"./wd-input.C2gvQ-R0.js";import{_ as ie}from"./wd-button.BzRx3gca.js";import{u as re,w as ue}from"./wd-toast.BszgenSq.js";import"./index.BkHvPazf.js";import{c as ne}from"./auth.BcWY81ex.js";import"./useChildren.Crbe03ZE.js";import"./types.DZx-jF8C.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.Prh_CF5p.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";const ce=le(e({name:"wd-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...A},setup(e,{expose:f}){const v=s(!1),_=a({url:"",poster:"",title:""});function y(){v.value=!1,m((()=>{_.url="",_.poster="",_.title=""}))}return se((()=>v.value)),f({open:function(e){v.value=!0,_.url=e.url,_.poster=e.poster,_.title=e.title},close:y}),(e,s)=>{const a=c,m=u;return v.value?(t(),l(m,{key:0,class:p(`wd-video-preview ${e.customClass}`),style:d(e.customStyle),onClick:y},{default:i((()=>[r(m,{class:"wd-video-preview__video",onClick:s[0]||(s[0]=n((()=>{}),["stop"]))},{default:i((()=>[_.url?(t(),l(a,{key:0,class:"wd-video-preview__video",controls:!0,poster:_.poster,title:_.title,"play-btn-position":"center",enableNative:!0,src:_.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):o("",!0)])),_:1}),r(R,{name:"close","custom-class":"wd-video-preview__close",onClick:y})])),_:1},8,["class","style"])):o("",!0)}}}),[["__scopeId","data-v-633c6945"]]);function de(e){if(G(e.tempFiles)){const s=[];return e.tempFiles.forEach((async e=>{s.push({path:e.path||"",name:e.name||"",size:e.size,type:"image",thumb:e.path||""})})),s}return[{path:e.tempFiles.path||"",name:e.tempFiles.name||"",size:e.tempFiles.size,type:"image",thumb:e.tempFiles.path||""}]}const pe=le(e({name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...A,fileList:q(),action:H(""),header:{type:Object,default:()=>({})},multiple:B(!1),disabled:B(!1),limit:Number,showLimitNum:B(!0),maxSize:O(Number.MAX_VALUE),sourceType:{type:Array,default:()=>["album","camera"]},sizeType:{type:Array,default:()=>["original","compressed"]},name:H("file"),formData:{type:Object,default:()=>{}},onPreviewFail:Function,beforeUpload:Function,beforeChoose:Function,beforeRemove:Function,beforePreview:Function,buildFormData:Function,loadingType:H("ring"),loadingColor:H("#ffffff"),accept:H("image"),statusKey:H("status"),loadingSize:H("24px"),compressed:B(!0),maxDuration:O(60),camera:H("back"),imageMode:H("aspectFit"),successStatus:O(200),customEvokeClass:H(""),customPreviewClass:H(""),autoUpload:B(!0),reupload:B(!1),uploadMethod:Function},emits:["fail","change","success","progress","oversize","chooseerror","remove","update:fileList"],setup(e,{expose:a,emit:n}){const m=e,M=n;a({submit:()=>G()});const{translate:E}=oe("upload"),K=s([]),S=y((()=>!m.limit||K.value.length<m.limit)),U=s();function N(){M("update:fileList",K.value)}b((()=>m.fileList),(e=>{const{statusKey:s}=m;if(ee(e,K.value))return;const a=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",{...e,uid:Z.id++})));K.value=a}),{deep:!0,immediate:!0}),b((()=>m.limit),(e=>{e&&e<K.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),b((()=>m.beforePreview),(e=>{e&&!X(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),b((()=>m.onPreviewFail),(e=>{e&&!X(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),b((()=>m.beforeRemove),(e=>{e&&!X(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),b((()=>m.beforeUpload),(e=>{e&&!X(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),b((()=>m.beforeChoose),(e=>{e&&!X(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),b((()=>m.buildFormData),(e=>{e&&!X(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0});const V=(e,s,a)=>{const{statusKey:l,uploadMethod:o}=m;e[l]="loading",X(o)?o(e,s,a):((e,s,a)=>{z({url:a.action,header:a.header,name:a.name,fileName:a.name,fileType:a.fileType,formData:s,filePath:e.url,success(l){l.statusCode===a.statusCode?a.onSuccess(l,e,s):a.onError({...l,errMsg:l.errMsg||""},e,s)},fail(l){a.onError(l,e,s)}}).onProgressUpdate((s=>{a.onProgress(s,e)}))})(e,s,a)};function $(e){return new Promise(((s,a)=>{I({src:e,success:e=>{s(e)},fail:e=>{a(e)}})}))}function A(e,s){const{statusKey:a}=m,l={uid:Z.id++,name:e.name||"",thumb:e.thumb||"",[a]:"pending",size:e.size||0,url:e.path,percent:0};"number"==typeof s?K.value.splice(s,1,l):K.value.push(l),m.autoUpload&&G()}function G(){const{buildFormData:e,formData:s={},statusKey:a}=m,{action:l,name:o,header:t={},accept:i,successStatus:r}=m,u=Y(r)?r:200;for(const n of K.value)"pending"==n[a]&&(e?e({file:n,formData:s,resolve:e=>{e&&V(n,e,{onSuccess:H,onError:B,onProgress:O,action:l,header:t,name:o,fileName:o,fileType:i,statusCode:u})}}):V(n,s,{onSuccess:H,onError:B,onProgress:O,action:l,header:t,name:o,fileName:o,fileType:i,statusCode:u}))}function B(e,s,a){const{statusKey:l}=m,o=K.value.findIndex((e=>e.uid===s.uid));o>-1&&(K.value[o][l]="fail",K.value[o].error=e.message,K.value[o].response=e,M("fail",{error:e,file:s,formData:a}),N())}function H(e,s,a){const{statusKey:l}=m,o=K.value.findIndex((e=>e.uid===s.uid));o>-1&&(K.value[o][l]="success",K.value[o].response=e.data,M("change",{fileList:K.value}),M("success",{file:s,fileList:K.value,formData:a}),N())}function O(e,s){const a=K.value.findIndex((e=>e.uid===s.uid));a>-1&&(K.value[a].percent=e.progress,M("progress",{response:e,file:s}))}function q(e){const{multiple:s,maxSize:a,accept:l,sizeType:o,limit:t,sourceType:i,compressed:r,maxDuration:u,camera:n,beforeUpload:c}=m;(function({multiple:e,sizeType:s,sourceType:a,maxCount:l,accept:o,compressed:t,maxDuration:i,camera:r}){return new Promise(((u,n)=>{switch(o){case"image":f({count:e?Math.min(l,9):1,sizeType:s,sourceType:a,success:e=>u(de(e)),fail:e=>{n(e)}});break;case"video":_({sourceType:a,compressed:t,maxDuration:i,camera:r,success:e=>{u(function(e){return[{path:e.tempFilePath||e.filePath||"",name:e.name||"",size:e.size,type:"video",thumb:e.thumbTempFilePath||"",duration:e.duration}]}(e))},fail:n});break;case"all":v({count:e?Math.min(l,100):1,type:o,success:e=>u(e.tempFiles),fail:n});break;default:f({count:e?Math.min(l,9):1,sizeType:s,sourceType:a,success:e=>u(de(e)),fail:n})}}))})({multiple:s,sizeType:o,sourceType:i,maxCount:t?t-K.value.length:9,accept:l,compressed:r,maxDuration:u,camera:n}).then((l=>{let o=l;s||(o=o.slice(0,1));const t=async s=>{for(let l=0;l<s.length;l++){const o=s[l];if("image"===o.type&&!o.size){const e=await $(o.path);o.size=e.width*e.height}Number(o.size)<=a?A(o,e):M("oversize",{file:o})}};c?c({files:o,fileList:K.value,resolve:e=>{e&&t(o)}}):t(o)})).catch((e=>{M("chooseerror",{error:e})}))}function se(e){if(m.disabled)return;const{beforeChoose:s}=m;s?s({fileList:K.value,resolve:s=>{s&&q(e)}}):q(e)}function le(e){K.value.splice(K.value.findIndex((s=>s.uid===e.uid)),1),M("change",{fileList:K.value}),M("remove",{file:e}),N()}function te(e){P({filePath:e.url,showMenu:!0})}function ie(e,s){const{onPreviewFail:a}=m;L({urls:s,current:s[e],fail(){a?a({index:e,imgList:s}):D({title:"预览图片失败",icon:"none"})}})}function re(e,s){var a;const{onPreviewFail:l}=m;null==(a=U.value)||a.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function ue(e){const{beforePreview:s,reupload:a}=m,l=J(K.value),o=l.findIndex((s=>s.url===e.url)),t=l.filter((e=>ne(e))),i=t.findIndex((s=>s.url===e.url));a?se(o):s?s({file:e,index:o,imgList:[],fileList:l,resolve:e=>{e&&re(i,t)}}):re(i,t)}function ne(e){return e.name&&Q(e.name)||Q(e.url)}function pe(e){return e.name&&W(e.name)||W(e.url)}return(e,s)=>{const a=C,n=u,f=c,v=T;return t(),h(w,null,[r(n,{class:p(["wd-upload",e.customClass]),style:d(e.customStyle)},{default:i((()=>[(t(!0),h(w,null,g(K.value,((s,u)=>(t(),l(n,{class:p(["wd-upload__preview",e.customPreviewClass]),key:u},{default:i((()=>[r(n,{class:"wd-upload__status-content"},{default:i((()=>[pe(s)?(t(),l(a,{key:0,src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s,reupload:a}=m,l=J(K.value),o=l.findIndex((s=>s.url===e.url)),t=l.filter((e=>pe(e))).map((e=>e.url)),i=t.findIndex((s=>s===e.url));a?se(o):s?s({file:e,index:o,fileList:l,imgList:t,resolve:e=>{e&&ie(i,t)}}):ie(i,t)}(s)},null,8,["src","mode","onClick"])):ne(s)?(t(),h(w,{key:1},[s.thumb?(t(),l(n,{key:0,class:"wd-upload__video",onClick:e=>ue(s)},{default:i((()=>[r(a,{src:s.thumb,mode:e.imageMode,class:"wd-upload__picture"},null,8,["src","mode"]),r(R,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"])):(t(),l(n,{key:1,class:"wd-upload__video",onClick:e=>ue(s)},{default:i((()=>[r(f,{src:s.url,title:s.name||"视频"+u,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wd-upload__video"},null,8,["src","title","poster"]),r(R,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(t(),l(n,{key:2,class:"wd-upload__file",onClick:e=>function(e){const{beforePreview:s,reupload:a}=m,l=J(K.value),o=l.findIndex((s=>s.url===e.url));a?se(o):s?s({file:e,index:o,imgList:[],fileList:l,resolve:s=>{s&&te(e)}}):te(e)}(s)},{default:i((()=>[r(R,{name:"file","custom-class":"wd-upload__file-icon"}),r(n,{class:"wd-upload__file-name"},{default:i((()=>[x(F(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s[m.statusKey]?(t(),l(n,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:i((()=>["loading"===s[m.statusKey]?(t(),l(n,{key:0,class:"wd-upload__status-content"},{default:i((()=>[r(ae,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),r(v,{class:"wd-upload__progress-txt"},{default:i((()=>[x(F(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):o("",!0),"fail"===s[m.statusKey]?(t(),l(n,{key:1,class:"wd-upload__status-content"},{default:i((()=>[r(R,{name:"close-outline","custom-class":"wd-upload__icon"}),r(v,{class:"wd-upload__progress-txt"},{default:i((()=>[x(F(s.error||j(E)("error")),1)])),_:2},1024)])),_:2},1024)):o("",!0)])),_:2},1024)):o("",!0),"loading"===s[m.statusKey]||e.disabled?o("",!0):(t(),l(R,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=m,a=e,l=K.value[a];s?s({file:l,index:a,fileList:K.value,resolve:e=>{e&&le(l)}}):le(l)}(u)},null,8,["onClick"])),e.$slots["preview-cover"]?k(e.$slots,"preview-cover",{key:2,file:s,index:u},void 0,!0):o("",!0)])),_:2},1032,["class"])))),128)),S.value?(t(),h(w,{key:0},[e.$slots.default?(t(),l(n,{key:0,class:p(["wd-upload__evoke-slot",e.customEvokeClass]),onClick:se},{default:i((()=>[k(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(t(),l(n,{key:1,onClick:se,class:p(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:i((()=>[r(R,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(t(),l(n,{key:0,class:"wd-upload__evoke-num"},{default:i((()=>[x("（"+F(K.value.length)+"/"+F(e.limit)+"）",1)])),_:1})):o("",!0)])),_:1},8,["class"]))],64)):o("",!0)])),_:3},8,["class","style"]),r(ce,{ref_key:"videoPreview",ref:U},null,512)],64)}}}),[["__scopeId","data-v-96bc56af"]]),me=le(e({__name:"index",setup(e){const a=re();M((()=>{ne()}));const o=[{label:"功能异常",value:"bug"},{label:"优化建议",value:"suggestion"},{label:"其他问题",value:"other"}],n=s("bug"),c=s(""),d=s([]),p=s(""),m=s(!1),f=e=>["image/jpeg","image/png","image/gif"].includes(e.type)?!(e.size>5242880)||(a.error("图片大小不能超过 5MB"),!1):(a.error("请上传 jpg、png 或 gif 格式的图片"),!1),v=e=>{const s=e.index;d.value.splice(s,1)},_=async()=>{if(c.value.trim()){m.value=!0;try{await new Promise((e=>setTimeout(e,1500))),a.success("提交成功"),c.value="",d.value=[],p.value="",setTimeout((()=>{N()}),1500)}catch{a.error("提交失败，请重试")}finally{m.value=!1}}else a.error("请描述您遇到的问题")};return(e,s)=>{const a=T,y=U,b=S,k=u,C=E(K("wd-cell-group"),V),j=E(K("wd-textarea"),$),z=E(K("wd-upload"),pe),P=E(K("wd-input"),te),L=E(K("wd-button"),ie),D=E(K("wd-toast"),ue);return t(),l(k,{class:"feedback-container"},{default:i((()=>[r(C,{title:"问题类型",border:"",class:"border"},{default:i((()=>[r(k,{class:"radio-group"},{default:i((()=>[(t(),h(w,null,g(o,(e=>r(b,{key:e.value,class:"radio-item"},{default:i((()=>[r(a,{class:"radio-text"},{default:i((()=>[x(F(e.label),1)])),_:2},1024),r(y,{value:e.value,checked:n.value===e.value,color:"#0083ff",class:"radio-button color-_wn_0083ff",style:{transform:"scale(0.8)"},onClick:s=>{return a=e.value,void(n.value=a);var a}},null,8,["value","checked","onClick"])])),_:2},1024))),64))])),_:1})])),_:1}),r(C,{title:"问题描述",border:"",class:"border"},{default:i((()=>[r(j,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),placeholder:"请详细描述您遇到的问题或建议...",maxlength:500,"show-count":"",rows:5,class:"show-count"},null,8,["modelValue"])])),_:1}),r(C,{title:"相关截图（选填）",border:"",class:"border"},{default:i((()=>[r(k,{class:"upload-box"},{default:i((()=>[r(z,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=e=>d.value=e),"max-count":3,"before-read":f,onDelete:v},null,8,["modelValue"])])),_:1})])),_:1}),r(C,{title:"联系方式（选填）",border:"",class:"border"},{default:i((()=>[r(P,{modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=e=>p.value=e),placeholder:"请输入您的手机号或邮箱",clearable:"",class:"clearable"},null,8,["modelValue"])])),_:1}),r(k,{class:"submit-btn"},{default:i((()=>[r(L,{type:"primary",block:"",loading:m.value,onClick:_,class:"block"},{default:i((()=>[x(" 提交反馈 ")])),_:1},8,["loading"])])),_:1}),r(D)])),_:1})}}}),[["__scopeId","data-v-69147e21"]]);export{me as default};
