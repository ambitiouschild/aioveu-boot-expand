import{d as e,h as a,y as t,al as l,$ as s,a as o,w as r,i as n,o as c,e as d,s as u,g as i,t as m,ay as p,a4 as f,a6 as v,a0 as _,aI as y,a3 as N,aJ as b}from"./index-5U173LQ3.js";import{A as g}from"./aioveu-department.Ni2j20Wl.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=h(e({__name:"form",setup(e){const h=a("新增部门"),D=a(void 0),I=a(!1),w=a(void 0),k=t({deptName:"",parentDeptId:void 0,parentDeptName:""}),x=a([]),j=a(-1);l((e=>{console.log("页面参数:",e),C(),e.id?(D.value=Number(e.id),h.value="编辑部门",A()):h.value="新增部门",w.value=D.value}));const A=async()=>{if(D.value)try{I.value=!0;const e=await g.getFormData(D.value);if(Object.assign(k,e),k.parentDeptName){const e=x.value.findIndex((e=>e.deptName===k.parentDeptName));j.value=e}}catch(e){console.error("加载部门数据失败:",e),s({title:"加载数据失败",icon:"none"})}finally{I.value=!1}},C=async()=>{try{const e=await g.getAllDepartmentOptions();Array.isArray(e)&&(x.value=e.map((e=>({deptId:Number(e.deptId),deptName:e.deptName}))))}catch(e){console.error("加载上级部门列表失败:",e),s({title:"加载上级部门列表失败",icon:"none"})}},V=e=>{const a=e.detail.value;j.value=a,x.value[a]&&(k.parentDeptName=x.value[a].deptName,k.parentDeptId=x.value[a].deptId)},O=async()=>{if(E())try{y({title:"提交中..."});const e=w.value;e?(await g.update(e,k),s({title:"修改成功",icon:"success"})):(await g.add(k),s({title:"新增成功",icon:"success"})),N()}catch(e){console.error("提交表单失败:",e),s({title:"提交失败",icon:"none"})}finally{b()}},E=()=>!!k.deptName||(s({title:"请输入部门名称",icon:"none"}),!1),F=()=>{N()};return(e,a)=>{const t=u,l=n,s=f,y=v,N=p,b=_;return c(),o(l,{class:"form-container"},{default:r((()=>[d(l,{class:"form-header"},{default:r((()=>[d(t,{class:"form-title"},{default:r((()=>[i(m(h.value),1)])),_:1})])),_:1}),d(N,{class:"form-body scroll-y","scroll-y":""},{default:r((()=>[d(l,{class:"form-item"},{default:r((()=>[d(t,{class:"form-label"},{default:r((()=>[i("部门名称")])),_:1}),d(s,{type:"text",class:"form-input",placeholder:"请输入部门名称",modelValue:k.deptName,"onUpdate:modelValue":a[0]||(a[0]=e=>k.deptName=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:r((()=>[d(t,{class:"form-label"},{default:r((()=>[i("上级部门")])),_:1}),d(y,{class:"form-picker",mode:"selector",range:x.value,"range-key":"deptName",value:j.value,onChange:V},{default:r((()=>[d(l,{class:"picker-view"},{default:r((()=>[i(m(j.value>=0?x.value[j.value].deptName:"请选择上级部门"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1}),d(l,{class:"form-footer"},{default:r((()=>[d(b,{class:"form-btn cancel",onClick:F},{default:r((()=>[i("取消")])),_:1}),d(b,{class:"form-btn confirm",onClick:O},{default:r((()=>[i("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-b8fc7b6f"]]);export{D as default};
