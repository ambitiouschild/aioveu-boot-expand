import{d as e,h as a,y as l,al as t,$ as o,a as s,w as r,i as c,o as n,e as u,s as m,g as i,t as d,ay as f,a4 as v,a6 as y,a5 as p,a0 as g,aI as _,a3 as N,aJ as b}from"./index-5U173LQ3.js";import{A as h}from"./aioveu-category.DEnk_6py.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=V(e({__name:"form",setup(e){const V=a("新增分类"),C=a(void 0),w=a(!1),x=l({name:"",parentCategoryName:"",level:void 0,description:""}),k=a([]),I=a(-1);t((e=>{console.log("页面参数:",e),A(),e.id?(C.value=Number(e.id),V.value="编辑分类",j()):V.value="新增分类"}));const j=async()=>{if(C.value)try{w.value=!0;const e=await h.getFormData(C.value);if(Object.assign(x,e),x.parentCategoryName){const e=k.value.findIndex((e=>e.categoryName===x.parentCategoryName));I.value=e}}catch(e){console.error("加载分类数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{w.value=!1}},A=async()=>{try{const e=await h.getAllCategoryOptions();Array.isArray(e)&&(k.value=e.map((e=>({categoryId:Number(e.categoryId),categoryName:e.categoryName}))))}catch(e){console.error("加载父分类列表失败:",e),o({title:"加载父分类列表失败",icon:"none"})}},U=e=>{const a=e.detail.value;I.value=a,k.value[a]&&(x.parentCategoryName=k.value[a].categoryName)},O=async()=>{if(D())try{_({title:"提交中..."}),C.value?(await h.update(C.value,x),o({title:"修改成功",icon:"success"})):(await h.add(x),o({title:"新增成功",icon:"success"})),N()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{b()}},D=()=>x.name?!!x.level||(o({title:"请输入分类层级",icon:"none"}),!1):(o({title:"请输入分类名称",icon:"none"}),!1),F=()=>{N()};return(e,a)=>{const l=m,t=c,o=v,_=y,N=p,b=f,h=g;return n(),s(t,{class:"form-container"},{default:r((()=>[u(t,{class:"form-header"},{default:r((()=>[u(l,{class:"form-title"},{default:r((()=>[i(d(V.value),1)])),_:1})])),_:1}),u(b,{class:"form-body scroll-y","scroll-y":""},{default:r((()=>[u(t,{class:"form-item"},{default:r((()=>[u(l,{class:"form-label"},{default:r((()=>[i("分类名称")])),_:1}),u(o,{type:"text",class:"form-input",placeholder:"请输入分类名称",modelValue:x.name,"onUpdate:modelValue":a[0]||(a[0]=e=>x.name=e)},null,8,["modelValue"])])),_:1}),u(t,{class:"form-item"},{default:r((()=>[u(l,{class:"form-label"},{default:r((()=>[i("父分类")])),_:1}),u(_,{class:"form-picker",mode:"selector",range:k.value,"range-key":"categoryName",value:I.value,onChange:U},{default:r((()=>[u(t,{class:"picker-view"},{default:r((()=>[i(d(I.value>=0?k.value[I.value].categoryName:"请选择父分类"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),u(t,{class:"form-item"},{default:r((()=>[u(l,{class:"form-label"},{default:r((()=>[i("分类层级")])),_:1}),u(o,{type:"number",class:"form-input",placeholder:"请输入分类层级",modelValue:x.level,"onUpdate:modelValue":a[1]||(a[1]=e=>x.level=e)},null,8,["modelValue"])])),_:1}),u(t,{class:"form-item"},{default:r((()=>[u(l,{class:"form-label"},{default:r((()=>[i("分类描述")])),_:1}),u(N,{class:"form-textarea",placeholder:"请输入分类描述",modelValue:x.description,"onUpdate:modelValue":a[2]||(a[2]=e=>x.description=e)},null,8,["modelValue"])])),_:1})])),_:1}),u(t,{class:"form-footer"},{default:r((()=>[u(h,{class:"form-btn cancel",onClick:F},{default:r((()=>[i("取消")])),_:1}),u(h,{class:"form-btn confirm",onClick:O},{default:r((()=>[i("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-17519d57"]]);export{C as default};
