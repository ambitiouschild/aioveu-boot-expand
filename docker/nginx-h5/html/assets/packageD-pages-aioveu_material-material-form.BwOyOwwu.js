import{d as e,h as a,y as l,al as o,$ as t,a as s,w as c,i as r,o as u,e as i,s as n,g as m,t as d,ay as f,a4 as v,a6 as p,a0 as y,aI as _,a3 as g,aJ as b}from"./index-5U173LQ3.js";import{A as h}from"./aioveu-material.D870okzX.js";import{A as V}from"./aioveu-category.DEnk_6py.js";import{D as N}from"./dict.R0KYYCD_.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=k(e({__name:"form",setup(e){const k=a("新增物资"),x=a(void 0),I=a(!1),A=l({name:"",categoryName:"",purchasePrice:void 0,minStock:void 0,maxStock:void 0,isActive:void 0,barcode:""}),w=a([]),j=a([]),D=a(-1),S=a(-1);o((e=>{console.log("页面参数:",e),C(),P(),e.id?(x.value=Number(e.id),k.value="编辑物资",U()):k.value="新增物资"}));const U=async()=>{if(x.value)try{I.value=!0;const e=await h.getFormData(x.value);if(Object.assign(A,e),A.categoryName){const e=w.value.findIndex((e=>e.categoryName===A.categoryName));D.value=e}if(void 0!==A.isActive){const e=j.value.findIndex((e=>Number(e.value)===A.isActive));S.value=e}}catch(e){console.error("加载物资数据失败:",e),t({title:"加载数据失败",icon:"none"})}finally{I.value=!1}},C=async()=>{try{const e=await V.getAllCategoryOptions();Array.isArray(e)&&(w.value=e.map((e=>({categoryId:Number(e.categoryId),categoryName:e.categoryName}))))}catch(e){console.error("加载分类列表失败:",e),t({title:"加载分类列表失败",icon:"none"})}},P=async()=>{try{const e=await N.getDictItems("material_is_active");j.value=e}catch(e){console.error("加载启用状态失败:",e),t({title:"加载启用状态失败",icon:"none"})}},O=e=>{const a=e.detail.value;D.value=a,w.value[a]&&(A.categoryName=w.value[a].categoryName)},F=e=>{const a=e.detail.value;S.value=a,j.value[a]&&(A.isActive=Number(j.value[a].value))},J=async()=>{if(K())try{_({title:"提交中..."}),x.value?(await h.update(x.value,A),t({title:"修改成功",icon:"success"})):(await h.add(A),t({title:"新增成功",icon:"success"})),g()}catch(e){console.error("提交表单失败:",e),t({title:"提交失败",icon:"none"})}finally{b()}},K=()=>A.name?A.categoryName?A.purchasePrice?void 0===A.isActive?(t({title:"请选择启用状态",icon:"none"}),!1):!!A.barcode||(t({title:"请输入商品条码",icon:"none"}),!1):(t({title:"请输入采购单价",icon:"none"}),!1):(t({title:"请选择物资分类",icon:"none"}),!1):(t({title:"请输入物资名称",icon:"none"}),!1),L=()=>{g()};return(e,a)=>{const l=n,o=r,t=v,_=p,g=f,b=y;return u(),s(o,{class:"form-container"},{default:c((()=>[i(o,{class:"form-header"},{default:c((()=>[i(l,{class:"form-title"},{default:c((()=>[m(d(k.value),1)])),_:1})])),_:1}),i(g,{class:"form-body scroll-y","scroll-y":""},{default:c((()=>[i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("物资名称")])),_:1}),i(t,{type:"text",class:"form-input",placeholder:"请输入物资名称",modelValue:A.name,"onUpdate:modelValue":a[0]||(a[0]=e=>A.name=e)},null,8,["modelValue"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("物资分类")])),_:1}),i(_,{class:"form-picker",mode:"selector",range:w.value,"range-key":"categoryName",value:D.value,onChange:O},{default:c((()=>[i(o,{class:"picker-view"},{default:c((()=>[m(d(D.value>=0?w.value[D.value].categoryName:"请选择分类"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("采购单价")])),_:1}),i(t,{type:"number",class:"form-input",placeholder:"请输入采购单价",modelValue:A.purchasePrice,"onUpdate:modelValue":a[1]||(a[1]=e=>A.purchasePrice=e)},null,8,["modelValue"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("供应商ID")])),_:1}),i(t,{type:"text",class:"form-input",placeholder:"请输入供应商ID",modelValue:A.supplierId,"onUpdate:modelValue":a[2]||(a[2]=e=>A.supplierId=e)},null,8,["modelValue"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("最低库存量")])),_:1}),i(t,{type:"number",class:"form-input",placeholder:"请输入最低库存量",modelValue:A.minStock,"onUpdate:modelValue":a[3]||(a[3]=e=>A.minStock=e)},null,8,["modelValue"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("最高库存量")])),_:1}),i(t,{type:"number",class:"form-input",placeholder:"请输入最高库存量",modelValue:A.maxStock,"onUpdate:modelValue":a[4]||(a[4]=e=>A.maxStock=e)},null,8,["modelValue"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("启用状态")])),_:1}),i(_,{class:"form-picker",mode:"selector",range:j.value,"range-key":"label",value:S.value,onChange:F},{default:c((()=>[i(o,{class:"picker-view"},{default:c((()=>[m(d(S.value>=0?j.value[S.value].label:"请选择状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(o,{class:"form-item"},{default:c((()=>[i(l,{class:"form-label"},{default:c((()=>[m("商品条码")])),_:1}),i(t,{type:"text",class:"form-input",placeholder:"请输入商品条码",modelValue:A.barcode,"onUpdate:modelValue":a[5]||(a[5]=e=>A.barcode=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(o,{class:"form-footer"},{default:c((()=>[i(b,{class:"form-btn cancel",onClick:L},{default:c((()=>[m("取消")])),_:1}),i(b,{class:"form-btn confirm",onClick:J},{default:c((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f74512db"]]);export{x as default};
