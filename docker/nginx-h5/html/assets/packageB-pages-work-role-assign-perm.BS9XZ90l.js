import{aw as e,d as l,a,o as t,w as n,e as d,ay as s,c,F as o,r as i,i as u,f as r,n as h,b as f,g as p,t as k,s as v,h as y,k as b,u as g,al as x,E as m,G as S,R as C,$ as _,a3 as w}from"./index-5U173LQ3.js";import{_ as K}from"./wd-button.BzRx3gca.js";import{R as E,_ as F}from"./role.hH2QPHbF.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./clickoutside.C7ctyI5d.js";const A="/api/v1/menus",j={getRoutes:()=>e({url:`${A}/routes`,method:"GET"}),getOptions:l=>e({url:`${A}/options`,method:"GET",data:{onlyParent:l}})};function D(e){const l=Object.prototype.toString.call(e);let a;if("[object Array]"===l){a=[];for(let l=0;l<e.length;l++)a.push(D(e[l]))}else if("[object Object]"===l){a={};for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(a[l]=D(e[l]))}else a=e;return a}function R(e,l,a,t=!0){if(!e||0===e.length)return[];const n=[];for(let d=0;d<e.length;d++){const s=e[d];s[l]===a&&(t&&s.disabled||!s.disabled)&&n.push(s)}return n}function I(e,l,a,t=!0){if(!e||0===e.length)return null;const n=[];for(let d=0;d<e.length;d++){const s=e[d];s[l]===a&&(t&&s.disabled||!s.disabled)&&n.push(s.key)}return n.length?n:null}function B(e,...l){console.error(`DaTree: ${e}`,...l)}const $=Object.prototype.toString;function O(e,l){return $.call(e)===`[object ${l}]`}function N(e){return"function"==typeof e}function M(e){return e&&Array.isArray(e)}const T=L(l({name:"DaTree",props:{data:{type:Array,default:()=>[]},themeColor:{type:String,default:"#007aff"},showCheckbox:{type:Boolean,default:!1},defaultCheckedKeys:{type:[Array,String,Number],default:null},defaultExpandAll:{type:Boolean,default:!1},defaultExpandedKeys:{type:Array,default:null},filterValue:{type:String,default:""},expandChecked:{type:Boolean,default:!1},field:{type:Object,default:null},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},leafField:{type:String,default:"leaf"},appendField:{type:String,default:"append"},sortField:{type:String,default:"sort"},resultField:{type:String,default:""},isLeafFn:{type:Function,default:null},showRadioIcon:{type:Boolean,default:!0},onlyRadioLeaf:{type:Boolean,default:!1},checkStrictly:{type:Boolean,default:!1},loadMode:{type:Boolean,default:!1},loadApi:{type:Function,default:null},alwaysFirstLoad:{type:Boolean,default:!1},checkedDisabled:{type:Boolean,default:!1},packDisabledkey:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},indent:{type:Number,default:40}},emits:["change","expand"],setup(e,{emit:l}){const a=y([]),t=y([]),n=y({}),d=y([]),s=y(null),c=y(!1);let o={value:"value",label:"label",children:"children",disabled:"disabled",append:"append",leaf:"leaf",sort:"sort"};function i(l=[],a=null,d=0,s=-1){return l.reduce(((l,c,u)=>{var r,h,f;const p=c[o.value],k=c[o.children]||null,v=function(l,a,t,n){var d;const s=l[o.value],c=l[o.label],i=l[o.sort]||0,u=l[o.children]||null,r=l[o.append]||null;let h=l[o.disabled]||!1;h=(null==t?void 0:t.disabled)||h;let f=N(e.isLeafFn)?e.isLeafFn(l):l[o.leaf]||!1;const p=u&&0===u.length;let k=!0,v=e.defaultExpandAll||!1;const y=e.loadMode&&N(e.loadApi);u||(v=!1,y?k=!0:(f=!0,k=!1));p&&(v=!1,y?k=!0:(f=!0,k=!1));f?(k=!1,v=!1):k=!0;e.showCheckbox||e.onlyRadioLeaf&&(h=!f||((null==(d=null==t?void 0:t.originItem)?void 0:d.disabled)||!1));h&&(f||!u||p)&&(v=!1,k=!1);const b=t?t.key:null,g=e.defaultExpandAll||0===n,x={key:s,parentKey:b,label:c,append:r,isLeaf:f,showArrow:k,level:n,expand:v,show:g,sort:i,disabled:h,loaded:!1,loading:!1,indexs:[a],checkedStatus:0,parentKeys:[],childrenKeys:[],children:[],originItem:l};t&&(x.parentKeys=[t.key,...t.parentKeys],x.indexs=[...t.indexs,a]);return x}(c,u,a,d);if(s>-1){const e=((null==(r=a.childrenKeys)?void 0:r.length)||0)+s+1;(null==(h=null==a?void 0:a.childrenKeys)?void 0:h.includes(p))||(n.value[p]=v,t.value.splice(e,0,v),a.children.push(v),(null==(f=v.parentKeys)?void 0:f.length)&&v.parentKeys.forEach((e=>{n.value[e].childrenKeys=[...n.value[e].childrenKeys,v.key]})))}else n.value[p]=v,t.value.push(v);if(k&&k.length>0){const e=i(k,v,d+1);v.children=e;const l=e.reduce(((e,l)=>{const a=l.childrenKeys;return e.push(...a,l.key),e}),[]);v.childrenKeys=l}return l.push(v),l}),[])}function u(l){let a=null,t=[];return e.showCheckbox?(a=[...new Set(s.value||[])],t=e.expandChecked?[...s.value||[],...d.value||[]]:d.value):(a=s.value||null,t=e.expandChecked&&s.value?[s.value,...d.value||[]]:d.value),r(l,a,!0),t=[...new Set(t)],e.defaultExpandAll||f(l,t,!0),l.sort(((e,l)=>0===e.sort&&0===l.sort?0:e.parentKey===l.parentKey?e.sort-l.sort>0?1:-1:0)),l}function r(l,a,t=!0){if(e.showCheckbox)(null==a?void 0:a.length)&&a.forEach((l=>{const a=n.value[l];a&&function(l,a=!0){const{childrenKeys:t,parentKeys:d,disabled:s=!1}=l;if(!e.checkedDisabled&&s)return;l.checkedStatus=a?2:0,e.checkStrictly||(t.forEach((a=>{const t=g(n)[a];t.checkedStatus=!e.checkedDisabled&&t.disabled?t.checkedStatus:l.checkedStatus})),d.forEach((e=>{const l=n.value[e];l.checkedStatus=x(l)})))}(a,t)}));else for(let e=0;e<l.length;e++){const n=l[e];if(n.key===a){h(n,t);break}}}function h(l,a){var d;const{parentKeys:s,isLeaf:c,disabled:o=!1}=l;!e.checkedDisabled&&o||(!e.onlyRadioLeaf||c?((null==(d=t.value)?void 0:d.length)&&t.value.forEach((e=>{e.checkedStatus=0})),s.forEach((e=>{const l=n.value[e];l.checkedStatus=a?x(l):0})),l.checkedStatus=a?2:0):B(`限制了末节点选中，当前[${l.label}]非末节点`))}function f(e,l,a=!0){var t,d,s;if(!1!==a)for(let c=0;c<e.length;c++){const a=e[c];(null==l?void 0:l.includes(a.key))&&(a.expand=!0,(null==(d=a.children)?void 0:d.length)&&a.children.forEach((e=>{g(n)[e.key].show=!0})),(null==(s=a.parentKeys)?void 0:s.length)&&a.parentKeys.forEach((e=>{var l;const a=g(n)[e];a.expand=!0,(null==(l=a.children)?void 0:l.length)&&a.children.forEach((e=>{g(n)[e.key].show=!0}))})))}else for(let c=0;c<e.length;c++){const a=e[c];(null==l?void 0:l.includes(a.key))&&(a.expand=!1,(null==(t=a.childrenKeys)?void 0:t.length)&&a.childrenKeys.forEach((e=>{n.value[e].expand=!1,n.value[e].show=!1})))}}function p(a){const{childrenKeys:d,parentKeys:c,checkedStatus:o,isLeaf:i,disabled:u=!1}=a;if(!e.showCheckbox)return;if(u)return;a.checkedStatus=2===o?0:2,e.checkStrictly?e.expandChecked&&B("多选时，当 checkStrictly 为 true 时，不支持选择自动展开子节点属性(expandChecked)"):(e.expandChecked&&(a.show=!0,a.expand=(null==d?void 0:d.length)>0||i),d.forEach((l=>{var t;const d=g(n)[l];d.checkedStatus=d.disabled?d.checkedStatus:a.checkedStatus,e.expandChecked&&(d.show=!0,d.expand=(null==(t=null==d?void 0:d.childrenKeys)?void 0:t.length)>0||d.isLeaf)}))),e.checkStrictly||c.forEach((e=>{const l=n.value[e];l.checkedStatus=x(l)}));const r=[];for(let l=0;l<t.value.length;l++){const a=t.value[l];2===a.checkedStatus&&(e.packDisabledkey&&a.disabled||!a.disabled)&&r.push(a.key)}s.value=[...r],l("change",r,a)}function k(a){var d;const{parentKeys:c,checkedStatus:o,key:i,disabled:u=!1,isLeaf:r}=a;if(!e.showCheckbox&&(e.onlyRadioLeaf&&!r&&v(a),!u)){if(null==(d=t.value)?void 0:d.length)for(let e=0;e<t.value.length;e++){t.value[e].checkedStatus=0}c.forEach((e=>{const l=n.value[e];l.checkedStatus=x(l)})),a.checkedStatus=2===o?0:2,s.value=i,l("change",i,a)}}async function v(a){if(e.filterValue)return;const{expand:s,loading:r=!1,disabled:h}=a;if(c.value&&r)return;!function(e){const{expand:l,childrenKeys:a,children:t=null}=e;if(l)(null==a?void 0:a.length)&&a.forEach((e=>{g(n)[e]&&(g(n)[e].show=!1,g(n)[e].expand=!1)}));else if(null==t?void 0:t.length){t.map((e=>e.key)).forEach((e=>{g(n)[e]&&(g(n)[e].show=!0)}))}}(a),a.expand=!s;let f=null;h||(!e.showCheckbox&&e.onlyRadioLeaf&&e.loadMode?B("单选时，当 onlyRadioLeaf 为 true 时不支持动态数据"):f=await async function(l){var a;const{expand:n,key:s,loaded:r,children:h}=l;if((null==h?void 0:h.length)&&!e.alwaysFirstLoad)return l;if(n&&e.loadMode&&!r){if(N(e.loadApi)){d.value.push(s),c.value=!0,l.loading=!0;const n=D(l),r=await e.loadApi(n);let h=[...(null==(a=l.originItem)?void 0:a.children)||[],...r||[]];const f={};if(h=h.reduce(((e,l)=>(f[l[o.value]]||(f[l[o.value]]=!0,e.push(l)),e)),[]),l.originItem.children=h||null,null==r?void 0:r.length){const e=t.value.findIndex((e=>e.key===l.key));i(r,l,l.level+1,e),t.value=u(t.value)}else l.expand=!1,l.isLeaf=!0,l.showArrow=!1;c.value=!1,l.loading=!1,l.loaded=!0}}else{const e=d.value.findIndex((e=>e===s));e>=0&&d.value.splice(e,1)}return l}(a)),l("expand",!s,f||a||null)}function x(l){if(!l)return 0;if(!e.checkedDisabled&&l.disabled)return l.checkedStatus||0;if(!e.showCheckbox)return 1;const{children:a}=l;if(a.every((e=>2===e.checkedStatus)))return 2;return a.every((e=>0===e.checkedStatus))?0:1}return b((()=>e.defaultExpandedKeys),(e=>{(null==e?void 0:e.length)?d.value=e:d.value=[]}),{immediate:!0}),b((()=>e.defaultCheckedKeys),(l=>{e.showCheckbox?(null==l?void 0:l.length)?s.value=l:s.value=[]:s.value=l||0===l?l:null}),{immediate:!0}),b((()=>e.data),(l=>{a.value=D(l),setTimeout((()=>{!function(){var l,d,s,c,r,h,f,p;o={value:(null==(l=e.field)?void 0:l.key)||(null==(d=e.field)?void 0:d.value)||e.valueField||"value",label:(null==(s=e.field)?void 0:s.label)||e.labelField||"label",children:(null==(c=e.field)?void 0:c.children)||e.childrenField||"children",disabled:(null==(r=e.field)?void 0:r.disabled)||e.disabledField||"disabled",append:(null==(h=e.field)?void 0:h.append)||e.appendField||"append",leaf:(null==(f=e.field)?void 0:f.leaf)||e.leafField||"leaf",sort:(null==(p=e.field)?void 0:p.sort)||e.sortField||"sort"};const k=D(a.value);t.value=[],n.value={},i(k),t.value=u(t.value)}()}),36)}),{immediate:!0,deep:!0}),b((()=>e.filterValue),(()=>{""!==e.filterValue?(t.value.forEach((l=>{l.label.indexOf(e.filterValue)>-1?(l.show=!0,l.parentKeys.forEach((e=>{n.value[e].show=!0}))):l.show=!1})),t.value.forEach((e=>{e.show&&e.parentKeys.forEach((e=>{n.value[e].show=!0}))}))):t.value.forEach((e=>{e.show=!0}))})),{datalist:t,unCheckedStatus:0,halfCheckedStatus:1,isCheckedStatus:2,handleCheckChange:p,handleRadioChange:k,handleLabelClick:function(l){e.showCheckbox?p(l):k(l)},handleExpandedChange:v,loadLoading:c,getCheckedKeys:()=>I(t.value,"checkedStatus",2,e.packDisabledkey),setCheckedKeys:function(l,a=!0){if(e.showCheckbox){if(!M(l))return void B(`setCheckedKeys 第一个参数非数组，传入的是[${l}]`);const n=t.value;if(!1===a){let e=[];for(let a=0;a<s.value.length;a++){const t=s.value[a];l.includes(t)||e.push(t)}return e=[...new Set(e)],s.value=e,void r(n,l,!1)}const c=[...s.value,...l];return s.value=[...new Set(c)],r(n,s.value,!0),void(e.expandChecked&&a&&(d.value=[...new Set([...s.value||[],...l||[]])],f(n,l,!0)))}if(M(l)&&(l=l[0]),!(n=l,O(n,"String")||function(e){return O(e,"Number")}(l)))return void B("setCheckedKeys 第一个参数字符串或数字，传入的是==>",l);var n;const c=t.value;s.value=a?l:null,e.expandChecked&&a&&f(c,[l],!0),r(c,l,!!a)},getHalfCheckedKeys:()=>I(t.value,"checkedStatus",1,e.packDisabledkey),getUncheckedKeys:()=>I(t.value,"checkedStatus",0,e.packDisabledkey),getExpandedKeys:()=>I(t.value,"expand",!0),getUnexpandedKeys:()=>I(t.value,"expand",!1),setExpandedKeys:function(e,l=!0){if(!Array.isArray(e)&&"all"!==e)return void B("setExpandedKeys 第一个参数非数组，传入的是===>",e);const a=t.value;if("all"===e)return void a.forEach((e=>{e.expand=l,e.level>0&&(e.show=l)}));if(!1===l){const l=[];for(let a=0;a<d.value.length;a++){const t=d.value[a];e.includes(t)||l.push(t)}return d.value=[...new Set(l)],void f(a,e,!1)}const n=[];for(let t=0;t<a.length;t++)e.includes(a[t].key)&&n.push(a[t].key);d.value=[...new Set(n)],f(a,n,!0)},getCheckedNodes:()=>R(t.value,"checkedStatus",2,e.packDisabledkey),getHalfCheckedNodes:()=>R(t.value,"checkedStatus",1,e.packDisabledkey),getUncheckedNodes:()=>R(t.value,"checkedStatus",0,e.packDisabledkey),getExpandedNodes:()=>R(t.value,"expand",!0),getUnexpandedNodes:()=>R(t.value,"expand",!1)}}}),[["render",function(e,l,y,b,g,x){const m=u,S=v,C=s;return t(),a(m,{class:"da-tree",style:r({"--theme-color":e.themeColor})},{default:n((()=>[d(C,{class:"da-tree-scroll","scroll-y":!0,"scroll-x":!1},{default:n((()=>[(t(!0),c(o,null,i(e.datalist,(l=>(t(),a(m,{key:l.key,class:h(["da-tree-item",{"is-show":l.show}]),style:r({paddingLeft:l.level*e.indent+"rpx"})},{default:n((()=>[l.showArrow&&!e.filterValue?(t(),a(m,{key:0,class:"da-tree-item__icon",onClick:a=>e.handleExpandedChange(l)},{default:n((()=>[e.loadLoading&&l.loading?(t(),a(m,{key:0,class:h(["da-tree-item__icon--arr","is-loading"])})):(t(),a(m,{key:1,class:h(["da-tree-item__icon--arr","is-expand",{"is-right":!l.expand}])},null,8,["class"]))])),_:2},1032,["onClick"])):(t(),a(m,{key:1,class:"da-tree-item__icon"})),e.showCheckbox?(t(),a(m,{key:2,class:h(["da-tree-item__checkbox",[`da-tree-item__checkbox--${e.checkboxPlacement}`,{"is--disabled":l.disabled}]]),onClick:a=>e.handleCheckChange(l)},{default:n((()=>[l.checkedStatus===e.isCheckedStatus?(t(),a(m,{key:0,class:"da-tree-item__checkbox--icon da-tree-checkbox-checked"})):l.checkedStatus===e.halfCheckedStatus?(t(),a(m,{key:1,class:"da-tree-item__checkbox--icon da-tree-checkbox-indeterminate"})):(t(),a(m,{key:2,class:"da-tree-item__checkbox--icon da-tree-checkbox-outline"}))])),_:2},1032,["class","onClick"])):f("",!0),!e.showCheckbox&&e.showRadioIcon?(t(),a(m,{key:3,class:h(["da-tree-item__checkbox",[`da-tree-item__checkbox--${e.checkboxPlacement}`,{"is--disabled":l.disabled}]]),onClick:a=>e.handleRadioChange(l)},{default:n((()=>[l.checkedStatus===e.isCheckedStatus?(t(),a(m,{key:0,class:"da-tree-item__checkbox--icon da-tree-radio-checked"})):l.checkedStatus===e.halfCheckedStatus?(t(),a(m,{key:1,class:"da-tree-item__checkbox--icon da-tree-radio-indeterminate"})):(t(),a(m,{key:2,class:"da-tree-item__checkbox--icon da-tree-radio-outline"}))])),_:2},1032,["class","onClick"])):f("",!0),d(m,{class:h(["da-tree-item__label","da-tree-item__label--"+l.checkedStatus]),onClick:a=>e.handleLabelClick(l)},{default:n((()=>[p(k(l.label)+" ",1),l.append?(t(),a(S,{key:0,class:"da-tree-item__label--append"},{default:n((()=>[p(k(l.append),1)])),_:2},1024)):f("",!0)])),_:2},1032,["class","onClick"])])),_:2},1032,["class","style"])))),128))])),_:1})])),_:1},8,["style"])}],["__scopeId","data-v-3cb20629"]]),V=L(l({__name:"assign-perm",setup(e){let l=y();const s=y([]);let c=y([]);const o=y(),i=y();function r(e,l){var a;null==(a=o.value)||a.setExpandedKeys(e,l),i.value=!1}function h(e,l){var a;null==(a=o.value)||a.setCheckedKeys(e,l),i.value=!1}function f(){var e;if(l.value){const a=null==(e=o.value)?void 0:e.getCheckedKeys();E.updateRoleMenus(l.value,a).then((()=>{_({title:"分配权限成功",icon:"success"}),w({delta:1})}))}}return x((e=>{e&&e.id&&(l.value=e.id),async function(){s.value=await j.getOptions(!1),c.value=s.value.map((e=>e.value)),E.getRoleMenuIds(l.value).then((e=>{var l;const a=e;a&&a.length>0&&(null==(l=o.value)||l.setCheckedKeys(a,!0))}))}()})),(e,l)=>{const k=u,v=m(S("wd-button"),K),y=m(S("wd-fab"),F);return t(),a(k,null,{default:n((()=>[d(k,{class:"p-l-8 p-b-20"},{default:n((()=>[d(T,{ref_key:"DaTreeRef",ref:o,data:g(s),defaultExpandAll:!0,showCheckbox:!0},null,8,["data"])])),_:1}),d(y,{active:g(i),"onUpdate:active":l[4]||(l[4]=e=>C(i)?i.value=e:null),type:"primary",position:"right-top",direction:"bottom"},{default:n((()=>[d(v,{"custom-class":"custom-button",type:"primary",onClick:l[0]||(l[0]=e=>h(g(c),!0))},{default:n((()=>[p(" 全 选 ")])),_:1}),d(v,{"custom-class":"custom-button",type:"error",onClick:l[1]||(l[1]=e=>h(g(c),!1))},{default:n((()=>[p(" 全不选 ")])),_:1}),d(v,{"custom-class":"custom-button",type:"success",onClick:l[2]||(l[2]=e=>r("all",!0))},{default:n((()=>[p(" 全展开 ")])),_:1}),d(v,{"custom-class":"custom-button",type:"warning",onClick:l[3]||(l[3]=e=>r("all",!1))},{default:n((()=>[p(" 全收起 ")])),_:1})])),_:1},8,["active"]),d(k,{class:"footer-buttons style",style:{}},{default:n((()=>[d(v,{size:"medium",type:"primary",block:"",onClick:f,class:"block"},{default:n((()=>[p(" 确 定 ")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-a027d67b"]]);export{V as default};
