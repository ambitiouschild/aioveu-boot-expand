import{d as e,h as a,y as l,al as t,$ as o,a as s,w as u,i as r,o as m,e as c,s as d,g as n,t as i,ay as f,a6 as v,a4 as p,a5 as _,a0 as b,aI as y,a3 as h,aJ as V}from"./index-5U173LQ3.js";import{A as g}from"./aioveu-contact.B_5Ds4O-.js";import{A as N}from"./aioveu-customer.MhylDKEJ.js";import{D as k}from"./dict.R0KYYCD_.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=w(e({__name:"form",setup(e){const w=a("新增联系人"),x=a(void 0),I=a(!1),U=a(void 0),C=l({}),j=a([]),A=a([]),D=a([]),P=a(-1),O=a(-1),F=a(-1);t((e=>{console.log("页面参数:",e),X(),$(),e.id?(x.value=Number(e.id),w.value="编辑联系人",J()):w.value="新增联系人",U.value=x.value}));const J=async()=>{if(x.value)try{I.value=!0;const e=await g.getFormData(x.value);if(Object.assign(C,e),C.customerName){const e=j.value.findIndex((e=>e.customerName===C.customerName));P.value=e}if(void 0!==C.isPrimary){const e=A.value.findIndex((e=>Number(e.value)===C.isPrimary));O.value=e}if(void 0!==C.gender){const e=D.value.findIndex((e=>Number(e.value)===C.gender));F.value=e}}catch(e){console.error("加载联系人数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{I.value=!1}},X=async()=>{try{const e=await N.getAllCustomerOptions();Array.isArray(e)&&(j.value=e.map((e=>({customerId:Number(e.customerId),customerName:e.customerName}))))}catch(e){console.error("加载客户列表失败:",e),o({title:"加载客户列表失败",icon:"none"})}},$=async()=>{try{const e=await k.getDictItems("contact_is_primary");A.value=e;const a=await k.getDictItems("gender");D.value=a}catch(e){console.error("加载字典选项失败:",e),o({title:"加载选项失败",icon:"none"})}},q=e=>{const a=e.detail.value;P.value=a,j.value[a]&&(C.customerName=j.value[a].customerName)},z=e=>{const a=e.detail.value;O.value=a,A.value[a]&&(C.isPrimary=Number(A.value[a].value))},B=e=>{const a=e.detail.value;F.value=a,D.value[a]&&(C.gender=Number(D.value[a].value))},E=e=>{C.birthday=e.detail.value},G=async()=>{if(H())try{y({title:"提交中..."});const e=U.value;e?(await g.update(e,C),o({title:"修改成功",icon:"success"})):(await g.add(C),o({title:"新增成功",icon:"success"})),h()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{V()}},H=()=>C.customerName?C.name?void 0!==C.isPrimary||(o({title:"请选择是否是主联系人",icon:"none"}),!1):(o({title:"请输入联系人姓名",icon:"none"}),!1):(o({title:"请选择客户",icon:"none"}),!1),K=()=>{h()};return(e,a)=>{const l=d,t=r,o=v,y=p,h=_,V=f,g=b;return m(),s(t,{class:"form-container"},{default:u((()=>[c(t,{class:"form-header"},{default:u((()=>[c(l,{class:"form-title"},{default:u((()=>[n(i(w.value),1)])),_:1})])),_:1}),c(V,{class:"form-body scroll-y","scroll-y":""},{default:u((()=>[c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("客户")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:j.value,"range-key":"customerName",value:P.value,onChange:q},{default:u((()=>[c(t,{class:"picker-view"},{default:u((()=>[n(i(P.value>=0?j.value[P.value].customerName:"请选择客户"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("联系人姓名")])),_:1}),c(y,{type:"text",class:"form-input",placeholder:"请输入联系人姓名",modelValue:C.name,"onUpdate:modelValue":a[0]||(a[0]=e=>C.name=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("职位")])),_:1}),c(y,{type:"text",class:"form-input",placeholder:"请输入职位",modelValue:C.position,"onUpdate:modelValue":a[1]||(a[1]=e=>C.position=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("部门")])),_:1}),c(y,{type:"text",class:"form-input",placeholder:"请输入部门",modelValue:C.department,"onUpdate:modelValue":a[2]||(a[2]=e=>C.department=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("手机号码")])),_:1}),c(y,{type:"tel",class:"form-input",placeholder:"请输入手机号码",modelValue:C.mobile,"onUpdate:modelValue":a[3]||(a[3]=e=>C.mobile=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("办公电话")])),_:1}),c(y,{type:"tel",class:"form-input",placeholder:"请输入办公电话",modelValue:C.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>C.phone=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("电子邮箱")])),_:1}),c(y,{type:"email",class:"form-input",placeholder:"请输入电子邮箱",modelValue:C.email,"onUpdate:modelValue":a[5]||(a[5]=e=>C.email=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("微信号")])),_:1}),c(y,{type:"text",class:"form-input",placeholder:"请输入微信号",modelValue:C.wechat,"onUpdate:modelValue":a[6]||(a[6]=e=>C.wechat=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("主联系人")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:A.value,"range-key":"label",value:O.value,onChange:z},{default:u((()=>[c(t,{class:"picker-view"},{default:u((()=>[n(i(O.value>=0?A.value[O.value].label:"请选择主联系人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("性别")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:D.value,"range-key":"label",value:F.value,onChange:B},{default:u((()=>[c(t,{class:"picker-view"},{default:u((()=>[n(i(F.value>=0?D.value[F.value].label:"请选择性别"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("生日")])),_:1}),c(o,{class:"form-picker",mode:"date",value:C.birthday,onChange:E},{default:u((()=>[c(t,{class:"picker-view"},{default:u((()=>[n(i(C.birthday||"请选择生日"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("兴趣爱好")])),_:1}),c(y,{type:"text",class:"form-input",placeholder:"请输入兴趣爱好",modelValue:C.hobbies,"onUpdate:modelValue":a[7]||(a[7]=e=>C.hobbies=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:u((()=>[c(l,{class:"form-label"},{default:u((()=>[n("备注")])),_:1}),c(h,{class:"form-textarea",placeholder:"请输入备注",modelValue:C.notes,"onUpdate:modelValue":a[8]||(a[8]=e=>C.notes=e)},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-footer"},{default:u((()=>[c(g,{class:"form-btn cancel",onClick:K},{default:u((()=>[n("取消")])),_:1}),c(g,{class:"form-btn confirm",onClick:G},{default:u((()=>[n("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-2e1fe507"]]);export{x as default};
