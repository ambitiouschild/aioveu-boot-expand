import{d as e,y as l,h as a,z as s,a as o,w as r,ap as d,i,E as t,G as m,o as n,e as u,u as c,b as p,g as b,t as w,$ as f}from"./index-5U173LQ3.js";import{_ as v}from"./wd-cell.yQBIY-AL.js";import{_ as h}from"./wd-cell-group.CJNVuq-S.js";import{_}from"./wd-input.C2gvQ-R0.js";import{_ as k}from"./wd-button.BzRx3gca.js";import{_ as y}from"./wd-form.BbkYwo7Z.js";import{w as V}from"./wd-popup.BsbILK4T.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useChildren.Crbe03ZE.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./base64.3RFQOR3W.js";import"./wd-toast.BszgenSq.js";import"./wd-overlay.iGBdgU4M.js";import"./wd-transition.7-0aPBrJ.js";const j=P(e({__name:"index",setup(e){const P=l({oldPassword:[{required:!0,message:"请填写原密码"}],newPassword:[{required:!0,message:"请填写新密码"}],confirmPassword:[{required:!0,message:"请确认密码",validator:e=>e?e!==x.newPassword?Promise.reject("两次输入的密码不一致"):Promise.resolve():Promise.reject("请确认密码")}],mobile:[{required:!0,pattern:/^1[3-9]\d{9}$/,message:"请填写正确的手机号码"}],code:[{required:!0,message:"请填写验证码"}],email:[{required:!0,pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请填写正确的邮箱地址"}]}),j=l({visible:!1,type:""}),g=a(),x=l({}),C=l({}),I=l({}),E=a(),U=a(),q=a(),z=a(0),M=a(null),A=a(0),L=a(null),B=async()=>{g.value=await d.getProfile()},$=e=>{switch(j.type=e,j.visible=!0,e){case"password":x.oldPassword="",x.newPassword="",x.confirmPassword="";break;case"mobile":C.mobile="",C.code="";break;case"email":I.email="",I.code=""}},F=async e=>{"MOBILE"===e?U.value.validate("mobile").then((({valid:e})=>{e&&d.sendVerificationCode(C.mobile,"MOBILE").then((()=>{f({title:"验证码已发送",icon:"none"}),z.value=60,M.value=setInterval((()=>{z.value>0?z.value-=1:clearInterval(M.value)}),1e3)}))})):"EMAIL"===e&&q.value.validate("email").then((({valid:e})=>{e&&d.sendVerificationCode(I.email,"EMAIL").then((()=>{f({title:"验证码已发送",icon:"none"}),A.value=60,L.value=setInterval((()=>{A.value>0?A.value-=1:clearInterval(L.value)}),1e3)}))}))};function O(){"password"===j.type?E.value.validate().then((({valid:e})=>{e&&d.changePassword(x).then((()=>{f({title:"密码修改成功",icon:"none"}),j.visible=!1}))})):"mobile"===j.type?U.value.validate().then((({valid:e})=>{e&&d.bindMobile(C).then((()=>{f({title:"手机号绑定成功",icon:"none"}),j.visible=!1,B()}))})):"email"===j.type&&q.value.validate().then((({valid:e})=>{e&&d.bindEmail(I).then((()=>{f({title:"邮箱绑定成功",icon:"none"}),j.visible=!1,B()}))}))}return s((()=>{B()})),(e,l)=>{const a=t(m("wd-cell"),v),s=t(m("wd-cell-group"),h),d=i,f=t(m("wd-input"),_),M=t(m("wd-button"),k),L=t(m("wd-form"),y),B=t(m("wd-popup"),V);return n(),o(d,{class:"profile"},{default:r((()=>[u(d,{class:"profile-card"},{default:r((()=>[u(s,{border:"",class:"border"},{default:r((()=>{var e,s;return[u(a,{title:"账户密码",label:"定期修改密码有助于保护账户安全",value:"修改","is-link":"",onClick:l[0]||(l[0]=e=>$("password")),class:"is-link"}),u(a,{title:"绑定手机",value:null==(e=c(g))?void 0:e.mobile,"is-link":"",onClick:l[1]||(l[1]=e=>$("mobile")),class:"is-link"},null,8,["value"]),u(a,{title:"绑定邮箱",value:(null==(s=c(g))?void 0:s.email)?c(g).email:"未绑定邮箱","is-link":"",onClick:l[2]||(l[2]=e=>$("email")),class:"is-link"},null,8,["value"])]})),_:1})])),_:1}),u(B,{modelValue:c(j).visible,"onUpdate:modelValue":l[12]||(l[12]=e=>c(j).visible=e),position:"bottom"},{default:r((()=>["password"===c(j).type?(n(),o(L,{key:0,ref_key:"passwordChangeFormRef",ref:E,model:c(x),"custom-class":"edit-form"},{default:r((()=>[u(s,{border:"",class:"border"},{default:r((()=>[u(f,{modelValue:c(x).oldPassword,"onUpdate:modelValue":l[3]||(l[3]=e=>c(x).oldPassword=e),label:"原密码","label-width":"160rpx","show-password":"",clearable:"",placeholder:"请输入原密码",prop:"oldPassword",rules:c(P).oldPassword,class:"show-password clearable"},null,8,["modelValue","rules"]),u(f,{modelValue:c(x).newPassword,"onUpdate:modelValue":l[4]||(l[4]=e=>c(x).newPassword=e),label:"新密码","label-width":"160rpx","show-password":"",clearable:"",placeholder:"请输入新密码",prop:"newPassword",rules:c(P).newPassword,class:"show-password clearable"},null,8,["modelValue","rules"]),u(f,{modelValue:c(x).confirmPassword,"onUpdate:modelValue":l[5]||(l[5]=e=>c(x).confirmPassword=e),label:"确认密码","label-width":"160rpx","show-password":"",clearable:"",placeholder:"请确认新密码",prop:"confirmPassword",rules:c(P).confirmPassword,class:"show-password clearable"},null,8,["modelValue","rules"])])),_:1}),u(d,{class:"footer"},{default:r((()=>[u(M,{type:"primary",size:"large",block:"",onClick:O,class:"block"},{default:r((()=>[b("提交")])),_:1})])),_:1})])),_:1},8,["model"])):p("",!0),"mobile"===c(j).type?(n(),o(L,{key:1,ref_key:"mobileBindingFormRef",ref:U,model:c(C),"custom-class":"edit-form"},{default:r((()=>[u(s,{border:"",class:"border"},{default:r((()=>[u(f,{modelValue:c(C).mobile,"onUpdate:modelValue":l[6]||(l[6]=e=>c(C).mobile=e),label:"手机号码","label-width":"160rpx",clearable:"",placeholder:"请输入手机号码",prop:"mobile",rules:c(P).mobile,class:"clearable"},null,8,["modelValue","rules"]),u(f,{modelValue:c(C).code,"onUpdate:modelValue":l[8]||(l[8]=e=>c(C).code=e),label:"验证码","label-width":"160rpx",clearable:"",placeholder:"请输入验证码",prop:"code",rules:c(P).code,class:"clearable"},{suffix:r((()=>[u(M,{plain:"",disabled:c(z)>0,onClick:l[7]||(l[7]=e=>F("MOBILE")),class:"plain"},{default:r((()=>[b(w(c(z)>0?`${c(z)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue","rules"])])),_:1}),u(d,{class:"footer"},{default:r((()=>[u(M,{type:"primary",size:"large",block:"",onClick:O,class:"block"},{default:r((()=>[b("提交")])),_:1})])),_:1})])),_:1},8,["model"])):p("",!0),"email"===c(j).type?(n(),o(L,{key:2,ref_key:"emailBindingFormRef",ref:q,model:c(I),"custom-class":"edit-form"},{default:r((()=>[u(s,{border:"",class:"border"},{default:r((()=>[u(f,{modelValue:c(I).email,"onUpdate:modelValue":l[9]||(l[9]=e=>c(I).email=e),label:"邮箱","label-width":"160rpx",clearable:"",placeholder:"请输入邮箱",prop:"email",rules:c(P).email,class:"clearable"},null,8,["modelValue","rules"]),u(f,{modelValue:c(I).code,"onUpdate:modelValue":l[11]||(l[11]=e=>c(I).code=e),label:"验证码","label-width":"160rpx",clearable:"",placeholder:"请输入验证码",prop:"code",rules:c(P).code,class:"clearable"},{suffix:r((()=>[u(M,{plain:"",disabled:c(A)>0,onClick:l[10]||(l[10]=e=>F("EMAIL")),class:"plain"},{default:r((()=>[b(w(c(A)>0?`${c(A)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue","rules"])])),_:1}),u(d,{class:"footer"},{default:r((()=>[u(M,{type:"primary",size:"large",block:"",onClick:O,class:"block"},{default:r((()=>[b("提交")])),_:1})])),_:1})])),_:1},8,["model"])):p("",!0)])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-3142c5d3"]]);export{j as default};
