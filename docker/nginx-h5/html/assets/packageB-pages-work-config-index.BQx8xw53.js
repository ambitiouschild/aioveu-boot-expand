import{aw as e,d as l,h as a,y as t,ax as o,z as s,al as u,a as i,w as r,i as d,E as n,G as m,o as c,e as p,u as f,g as v,c as w,F as g,r as _,t as y,R as h,$ as x,aB as j,aa as b}from"./index-5U173LQ3.js";import{_ as k}from"./wd-input.C2gvQ-R0.js";import{_ as V}from"./wd-button.BzRx3gca.js";import{_ as C,a as $,b as N}from"./wd-loadmore.Dd59NB56.js";import{_ as z}from"./wd-cell.yQBIY-AL.js";import{_ as T}from"./wd-cell-group.CJNVuq-S.js";import{_ as U}from"./wd-card.qIX23JsB.js";import{_ as E}from"./wd-textarea.Dx53q_ul.js";import{_ as P}from"./wd-form.BbkYwo7Z.js";import{w as q}from"./wd-popup.BsbILK4T.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./base64.3RFQOR3W.js";import"./clickoutside.C7ctyI5d.js";import"./useChildren.Crbe03ZE.js";import"./wd-divider.DIyXdxGw.js";import"./wd-overlay.iGBdgU4M.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-toast.BszgenSq.js";const K="/api/v1/config",B={getPage:l=>e({url:`${K}/page`,method:"GET",data:l}),getFormData:l=>e({url:`${K}/${l}/form`,method:"GET"}),add:l=>e({url:`${K}`,method:"POST",data:l}),update:(l,a)=>e({url:`${K}/${l}`,method:"PUT",data:a}),deleteById:l=>e({url:`${K}/${l}`,method:"DELETE"}),refreshCache:()=>e({url:`${K}/refresh`,method:"PUT"})},D=(e,l)=>{let a=null;return function(...t){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,t)}),l)}},F=I(l({__name:"index",setup(e){const l=a("loading"),I=a(0),K=t({pageNum:1,pageSize:10,keywords:""}),F=a([]),G=a(),R=a(!1),L=a();function O(){var e;F.value=[],null==(e=L.value)||e.close(),K.pageNum=1,l.value="loading",B.getPage(K).then((e=>{1===K.pageNum?F.value=e.list:F.value.push(...e.list),I.value=e.total})).finally((()=>{l.value="finished"}))}const S=a(!1),M=a({});async function A(){R.value=!0;try{G.value&&G.value.validate().then((async({valid:e})=>{e?(M.value.id?(await B.update(M.value.id,M.value),x({title:"更新成功",icon:"success"})):(await B.add(M.value),x({title:"添加成功",icon:"success"})),S.value=!1,O()):(x({title:"请检查表单",icon:"error"}),R.value=!1)}))}catch{x({title:"操作失败",icon:"error"}),R.value=!1}finally{R.value=!1}}function H(){var e;K.pageNum=1,K.keywords="",F.value=[],null==(e=L.value)||e.close(),O()}function J(){M.value.id=void 0,M.value.configName="",M.value.configKey="",M.value.configValue="",M.value.remark="",S.value=!0}o((()=>{K.pageNum++,O()}));const Q=D((()=>{B.refreshCache().then((()=>{x({title:"刷新缓存成功",icon:"success",duration:1e3})}))}),1e3);function W(e){const l=["编辑","删除"];j({itemList:l,success:({tapIndex:a})=>{switch(l[a]){case"编辑":t=e.id||0,B.getFormData(t).then((e=>{Object.assign(M.value,e),S.value=!0}));break;case"删除":!function(e){b({title:"提示",content:"确定要删除该配置吗？",success:async l=>{l.confirm&&e.id&&B.deleteById(e.id).then((()=>{x({title:"删除成功",icon:"success"})}))}})}(e)}var t}})}return s((()=>{O()})),u((()=>{K.pageNum=1,O()})),(e,a)=>{const t=n(m("wd-input"),k),o=n(m("wd-button"),V),s=d,u=n(m("wd-drop-menu-item"),C),x=n(m("wd-drop-menu"),$),j=n(m("wd-cell"),z),b=n(m("wd-cell-group"),T),I=n(m("wd-card"),U),B=n(m("wd-loadmore"),N),D=n(m("wd-textarea"),E),X=n(m("wd-form"),P),Y=n(m("wd-popup"),q);return c(),i(s,{class:"work"},{default:r((()=>[p(x,{"close-on-click-modal":"",class:"mb-20rpx mr-20rpx ml-20rpx close-on-click-modal"},{default:r((()=>[p(u,{ref_key:"dropMenu",ref:L,title:"筛选",icon:"filter","icon-size":"18px"},{default:r((()=>[p(s,null,{default:r((()=>[p(t,{modelValue:f(K).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>f(K).keywords=e),label:"关键字",type:"text",clearable:"",placeholder:"请输入关键字",class:"clearable"},null,8,["modelValue"]),p(s,{class:"flex flex-row items-center mb-20rpx"},{default:r((()=>[p(o,{class:"mt-20rpx mb-20rpx",size:"medium",onClick:a[1]||(a[1]=e=>O())},{default:r((()=>[v(" 查询 ")])),_:1}),p(o,{size:"medium",type:"info",onClick:H},{default:r((()=>[v("重置")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1}),p(s,{class:"data-container"},{default:r((()=>[(c(!0),w(g,null,_(f(F),((e,l)=>(c(),i(s,{key:l,class:"mb-20rpx"},{default:r((()=>[p(I,null,{title:r((()=>[p(s,{class:"flex items-center justify-between"},{default:r((()=>[p(s,{class:"flex-1 text-truncate"},{default:r((()=>[v(y(e.configName),1)])),_:2},1024)])),_:2},1024)])),footer:r((()=>[p(o,{size:"small",plain:"",type:"primary",onClick:l=>W(e),class:"plain"},{default:r((()=>[v(" 操作 ")])),_:2},1032,["onClick"])])),default:r((()=>[p(b,null,{default:r((()=>[p(j,{title:"配置键",value:e.configKey},null,8,["value"]),p(j,{title:"配置值",value:e.configValue},null,8,["value"]),p(j,{title:"备注",value:e.remark},null,8,["value"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),p(B,{state:f(l),onReload:O},null,8,["state"]),p(s,{class:"fixed bottom-0 w-full flex justify-around items-center p-20rpx bg-_wn_fff"},{default:r((()=>[p(o,{size:"medium",type:"primary",onClick:J},{default:r((()=>[v("添加")])),_:1}),p(o,{size:"medium",type:"success",onClick:f(Q)},{default:r((()=>[v("刷新缓存")])),_:1},8,["onClick"])])),_:1}),p(Y,{modelValue:f(S),"onUpdate:modelValue":a[7]||(a[7]=e=>h(S)?S.value=e:null),position:"bottom"},{default:r((()=>[p(s,{class:"p-20rpx"},{default:r((()=>[p(X,{ref_key:"formRef",ref:G,model:f(M)},{default:r((()=>[p(t,{modelValue:f(M).configName,"onUpdate:modelValue":a[2]||(a[2]=e=>f(M).configName=e),label:"配置名称",type:"text",placeholder:"请输入配置名称",rules:[{required:!0,message:"请填写配置名称"}]},null,8,["modelValue"]),p(t,{modelValue:f(M).configKey,"onUpdate:modelValue":a[3]||(a[3]=e=>f(M).configKey=e),label:"配置键名",type:"text",placeholder:"请输入配置键名",rules:[{required:!0,message:"请填写配置键"}]},null,8,["modelValue"]),p(t,{modelValue:f(M).configValue,"onUpdate:modelValue":a[4]||(a[4]=e=>f(M).configValue=e),label:"配置键值",type:"text",placeholder:"请输入配置键值",rules:[{required:!0,message:"请填写配置值"}]},null,8,["modelValue"]),p(D,{modelValue:f(M).remark,"onUpdate:modelValue":a[5]||(a[5]=e=>f(M).remark=e),prop:"remark",label:"配置描述","label-align":"right",clearable:"",maxlength:100,"show-word-limit":"","label-width":"100px",placeholder:"请输入配置描述",class:"clearable show-word-limit"},null,8,["modelValue"])])),_:1},8,["model"]),p(s,{class:"flex justify-around mt-20rpx"},{default:r((()=>[p(o,{onClick:a[6]||(a[6]=e=>S.value=!1)},{default:r((()=>[v("取消")])),_:1}),p(o,{type:"primary","native-type":"submit",loading:f(R),onClick:A},{default:r((()=>[v(" 确定 ")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),[["__scopeId","data-v-42353a8e"]]);export{F as default};
