import{d as e,h as a,y as l,al as t,k as s,$ as o,a as r,w as u,i as d,o as m,e as n,s as i,g as c,t as f,ay as v,a6 as p,a4 as _,a5 as b,a0 as y,aI as h,a3 as N,aJ as V}from"./index-5U173LQ3.js";import{A as g,a as w,b as k}from"./aioveu-warehouse.C1Qj9JK7.js";import{A as I}from"./aioveu-sales-order.NYwjDYB-.js";import{D as O}from"./dict.R0KYYCD_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=x(e({__name:"form",setup(e){const x=a("新增订单明细"),A=a(void 0),U=a(!1),D=a(void 0),C=l({}),P=a([]),j=a([]),q=a([]),R=a([]),F=a(-1),J=a(-1),M=a(-1),S=a(-1);t((e=>{console.log("页面参数:",e),Z(),$(),z(),B(),e.id?(A.value=Number(e.id),x.value="编辑订单明细",W()):x.value="新增订单明细",D.value=A.value})),s((()=>[C.quantity,C.unitPrice,C.discount,C.taxRate]),(([e,a,l,t])=>{}),{deep:!0});const W=async()=>{if(A.value)try{U.value=!0;const e=await g.getFormData(A.value);if(Object.assign(C,e),C.orderName){const e=P.value.findIndex((e=>e.salesOrderNo===C.orderName));F.value=e}if(C.materialName){const e=j.value.findIndex((e=>e.materialName===C.materialName));J.value=e}if(C.warehouseName){const e=q.value.findIndex((e=>e.warehouseName===C.warehouseName));M.value=e}if(void 0!==C.status){const e=R.value.findIndex((e=>Number(e.value)===C.status));S.value=e}}catch(e){console.error("加载订单明细数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{U.value=!1}},Z=async()=>{try{const e=await I.getAllSalesOrderOptions();Array.isArray(e)&&(P.value=e.map((e=>({salesOrderId:Number(e.salesOrderId),salesOrderNo:e.salesOrderNo}))))}catch(e){console.error("加载销售订单列表失败:",e),o({title:"加载销售订单列表失败",icon:"none"})}},$=async()=>{try{const e=await w.getAllMaterialOptions();Array.isArray(e)&&(j.value=e.map((e=>({materialId:Number(e.materialId),materialName:e.materialName}))))}catch(e){console.error("加载物资列表失败:",e),o({title:"加载物资列表失败",icon:"none"})}},z=async()=>{try{const e=await k.getAllWarehouseOptions();Array.isArray(e)&&(q.value=e.map((e=>({warehouseId:Number(e.warehouseId),warehouseName:e.warehouseName}))))}catch(e){console.error("加载仓库列表失败:",e),o({title:"加载仓库列表失败",icon:"none"})}},B=async()=>{try{const e=await O.getDictItems("salesOrderDetail_status");R.value=e||[]}catch(e){console.error("加载字典选项失败:",e),o({title:"加载选项失败",icon:"none"})}},E=e=>{const a=e.detail.value;F.value=a,P.value[a]&&(C.orderName=P.value[a].salesOrderNo,C.orderId=P.value[a].salesOrderId)},G=e=>{const a=e.detail.value;J.value=a,j.value[a]&&(C.materialName=j.value[a].materialName)},H=e=>{const a=e.detail.value;M.value=a,q.value[a]&&(C.warehouseName=q.value[a].warehouseName)},K=e=>{const a=e.detail.value;S.value=a,R.value[a]&&(C.status=Number(R.value[a].value))},L=e=>{C.deliveryDate=e.detail.value},Q=async()=>{if(T())try{h({title:"提交中..."});const e=D.value;e?(await g.update(e,C),o({title:"修改成功",icon:"success"})):(await g.add(C),o({title:"新增成功",icon:"success"})),N()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{V()}},T=()=>C.orderName?C.materialName?void 0===C.quantity||C.quantity<=0?(o({title:"请输入有效的数量",icon:"none"}),!1):void 0===C.unitPrice||C.unitPrice<=0?(o({title:"请输入有效的单价",icon:"none"}),!1):void 0!==C.warehouseName||(o({title:"请选择发货仓库",icon:"none"}),!1):(o({title:"请选择物资",icon:"none"}),!1):(o({title:"请选择订单",icon:"none"}),!1),X=()=>{N()};return(e,a)=>{const l=i,t=d,s=p,o=_,h=b,N=v,V=y;return m(),r(t,{class:"form-container"},{default:u((()=>[n(t,{class:"form-header"},{default:u((()=>[n(l,{class:"form-title"},{default:u((()=>[c(f(x.value),1)])),_:1})])),_:1}),n(N,{class:"form-body scroll-y","scroll-y":""},{default:u((()=>[n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("订单")])),_:1}),n(s,{class:"form-picker",mode:"selector",range:P.value,"range-key":"salesOrderNo",value:F.value,onChange:E},{default:u((()=>[n(t,{class:"picker-view"},{default:u((()=>[c(f(F.value>=0?P.value[F.value].salesOrderNo:"请选择订单"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("物资")])),_:1}),n(s,{class:"form-picker",mode:"selector",range:j.value,"range-key":"materialName",value:J.value,onChange:G},{default:u((()=>[n(t,{class:"picker-view"},{default:u((()=>[c(f(J.value>=0?j.value[J.value].materialName:"请选择物资"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("数量")])),_:1}),n(o,{type:"number",class:"form-input",placeholder:"请输入数量",modelValue:C.quantity,"onUpdate:modelValue":a[0]||(a[0]=e=>C.quantity=e)},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("单价")])),_:1}),n(o,{type:"number",class:"form-input",placeholder:"请输入单价",modelValue:C.unitPrice,"onUpdate:modelValue":a[1]||(a[1]=e=>C.unitPrice=e)},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("折扣率")])),_:1}),n(o,{type:"number",class:"form-input",placeholder:"请输入折扣率",modelValue:C.discount,"onUpdate:modelValue":a[2]||(a[2]=e=>C.discount=e)},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("税率")])),_:1}),n(o,{type:"number",class:"form-input",placeholder:"请输入税率",modelValue:C.taxRate,"onUpdate:modelValue":a[3]||(a[3]=e=>C.taxRate=e)},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("小计")])),_:1}),n(o,{type:"number",class:"form-input disabled",placeholder:"自动计算",modelValue:C.subtotal,"onUpdate:modelValue":a[4]||(a[4]=e=>C.subtotal=e),disabled:""},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("税额")])),_:1}),n(o,{type:"number",class:"form-input disabled",placeholder:"自动计算",modelValue:C.taxAmount,"onUpdate:modelValue":a[5]||(a[5]=e=>C.taxAmount=e),disabled:""},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("总金额")])),_:1}),n(o,{type:"number",class:"form-input disabled",placeholder:"自动计算",modelValue:C.totalPrice,"onUpdate:modelValue":a[6]||(a[6]=e=>C.totalPrice=e),disabled:""},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("批次号")])),_:1}),n(o,{type:"text",class:"form-input",placeholder:"请输入批次号",modelValue:C.batchNumber,"onUpdate:modelValue":a[7]||(a[7]=e=>C.batchNumber=e)},null,8,["modelValue"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("要求交货日期")])),_:1}),n(s,{class:"form-picker",mode:"date",value:C.deliveryDate,onChange:L},{default:u((()=>[n(t,{class:"picker-view"},{default:u((()=>[c(f(C.deliveryDate||"请选择要求交货日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("发货仓库")])),_:1}),n(s,{class:"form-picker",mode:"selector",range:q.value,"range-key":"warehouseName",value:M.value,onChange:H},{default:u((()=>[n(t,{class:"picker-view"},{default:u((()=>[c(f(M.value>=0?q.value[M.value].warehouseName:"请选择发货仓库"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("明细状态")])),_:1}),n(s,{class:"form-picker",mode:"selector",range:R.value,"range-key":"label",value:S.value,onChange:K},{default:u((()=>[n(t,{class:"picker-view"},{default:u((()=>[c(f(S.value>=0?R.value[S.value].label:"请选择明细状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(t,{class:"form-item"},{default:u((()=>[n(l,{class:"form-label"},{default:u((()=>[c("备注")])),_:1}),n(h,{class:"form-textarea",placeholder:"请输入备注",modelValue:C.notes,"onUpdate:modelValue":a[8]||(a[8]=e=>C.notes=e)},null,8,["modelValue"])])),_:1})])),_:1}),n(t,{class:"form-footer"},{default:u((()=>[n(V,{class:"form-btn cancel",onClick:X},{default:u((()=>[c("取消")])),_:1}),n(V,{class:"form-btn confirm",onClick:Q},{default:u((()=>[c("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-c643298e"]]);export{A as default};
