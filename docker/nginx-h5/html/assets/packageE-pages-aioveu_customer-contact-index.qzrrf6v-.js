import{d as e,h as a,y as l,Y as t,z as s,a as u,w as c,$ as o,i as n,o as i,e as d,b as f,s as r,g as m,t as _,a4 as v,a6 as p,a0 as b,c as g,F as h,r as N,X as k,aa as y,aI as C,aJ as w}from"./index-5U173LQ3.js";import{A as I}from"./aioveu-contact.B_5Ds4O-.js";import{A as V}from"./aioveu-customer.MhylDKEJ.js";import{D as A}from"./dict.R0KYYCD_.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=D(e({__name:"index",setup(e){const D=a(!1),j=a([]),x=a(0),z=a(!1),S=l({pageNum:1,pageSize:10}),U=a([]),O=a([]),P=a([]),T=a([]),X=a([]),$=a(-1),B=a(-1),E=a(void 0),F=()=>{z.value=!z.value},J=e=>{const a=e.detail.value;$.value=a,O.value[a]&&(S.customerName=O.value[a].customerName)},M=e=>{const a=e.detail.value;B.value=a,P.value[a]&&(S.name=P.value[a].contactName)},Y=()=>{D.value=!0,I.getPage(S).then((e=>{U.value=e.list,x.value=e.total})).catch((e=>{console.error("查询联系人失败:",e),o({title:"加载数据失败",icon:"none"})})).finally((()=>{D.value=!1}))},q=()=>{S.pageNum=1,S.customerName="",S.name="",S.mobile="",S.email="",$.value=-1,B.value=-1,U.value=[],Y()},G=()=>{S.pageNum>1&&(S.pageNum--,Y())},H=()=>{S.pageNum*S.pageSize<x.value&&(S.pageNum++,Y())},K=a(!1);t((()=>{K.value&&(Y(),K.value=!1)}));const L=e=>{K.value=!0,E.value=e;let a="/packageE/pages/aioveu_customer/contact/form";void 0!==e&&(a+=`?id=${e}`),k({url:a})},Q=e=>{const a=e?[e]:j.value;0!==a.length?y({title:"提示",content:"确认删除选中的联系人吗？",success:e=>{e.confirm&&(C({title:"删除中..."}),I.deleteByIds(a.join(",")).then((()=>{o({title:"删除成功",icon:"success"}),q()})).catch((e=>{console.error("删除失败:",e),o({title:"删除失败",icon:"none"})})).finally((()=>w())))}}):o({title:"请选择要删除的联系人",icon:"none"})},R=e=>{const a=T.value.find((a=>Number(a.value)===e));return a?a.label:"未知"},W=e=>{const a=X.value.find((a=>Number(a.value)===e));return a?a.label:"未知"};return s((()=>{Y(),V.getAllCustomerOptions().then((e=>{Array.isArray(e)&&(O.value=e.map((e=>({customerId:Number(e.customerId),customerName:e.customerName}))))})).catch((e=>{console.error("加载客户选项失败:",e)})),I.getAllContactOptions().then((e=>{Array.isArray(e)&&(P.value=e.map((e=>({contactId:Number(e.contactId),contactName:e.contactName}))))})).catch((e=>{console.error("加载联系人选项失败:",e)})),A.getDictItems("contact_is_primary").then((e=>{T.value=e})),A.getDictItems("gender").then((e=>{X.value=e}))})),(e,a)=>{const l=r,t=n,s=v,o=p,k=b;return i(),u(t,{class:"app-container"},{default:c((()=>[d(t,{class:"search-container"},{default:c((()=>[d(t,{class:"filter-header",onClick:F},{default:c((()=>[d(l,null,{default:c((()=>[m("🔍 筛选条件")])),_:1}),d(l,null,{default:c((()=>[m(_(z.value?"▲":"▼"),1)])),_:1})])),_:1}),z.value?(i(),u(t,{key:0,class:"filter-content"},{default:c((()=>[d(t,{class:"filter-item"},{default:c((()=>[d(l,{class:"filter-label"},{default:c((()=>[m("联系人ID")])),_:1}),d(s,{type:"text",class:"filter-input",placeholder:"请输入联系人ID",modelValue:S.id,"onUpdate:modelValue":a[0]||(a[0]=e=>S.id=e),onConfirm:Y},null,8,["modelValue"])])),_:1}),d(t,{class:"filter-item"},{default:c((()=>[d(l,{class:"filter-label"},{default:c((()=>[m("客户")])),_:1}),d(o,{class:"filter-picker",mode:"selector",range:O.value,"range-key":"customerName",value:$.value,onChange:J},{default:c((()=>[d(t,{class:"picker-view"},{default:c((()=>[m(_($.value>=0?O.value[$.value].customerName:"请选择客户"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(t,{class:"filter-item"},{default:c((()=>[d(l,{class:"filter-label"},{default:c((()=>[m("联系人姓名")])),_:1}),d(o,{class:"filter-picker",mode:"selector",range:P.value,"range-key":"contactName",value:B.value,onChange:M},{default:c((()=>[d(t,{class:"picker-view"},{default:c((()=>[m(_(B.value>=0?P.value[B.value].contactName:"请选择联系人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(t,{class:"filter-item"},{default:c((()=>[d(l,{class:"filter-label"},{default:c((()=>[m("手机号码")])),_:1}),d(s,{type:"tel",class:"filter-input",placeholder:"请输入手机号码",modelValue:S.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>S.mobile=e),onConfirm:Y},null,8,["modelValue"])])),_:1}),d(t,{class:"filter-item"},{default:c((()=>[d(l,{class:"filter-label"},{default:c((()=>[m("电子邮箱")])),_:1}),d(s,{type:"email",class:"filter-input",placeholder:"请输入电子邮箱",modelValue:S.email,"onUpdate:modelValue":a[2]||(a[2]=e=>S.email=e),onConfirm:Y},null,8,["modelValue"])])),_:1}),d(t,{class:"filter-buttons"},{default:c((()=>[d(k,{class:"filter-btn reset",onClick:q},{default:c((()=>[m("重置")])),_:1}),d(k,{class:"filter-btn confirm",onClick:Y},{default:c((()=>[m("搜索")])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1}),d(t,{class:"action-buttons"},{default:c((()=>[d(k,{"v-has-perm":["aioveuContact:aioveu-contact:add"],class:"action-btn add",onClick:a[3]||(a[3]=e=>L())},{default:c((()=>[d(l,null,{default:c((()=>[m("+")])),_:1}),d(l,null,{default:c((()=>[m("新增")])),_:1})])),_:1}),d(k,{"v-has-perm":["aioveuContact:aioveu-contact:delete"],class:"action-btn delete",disabled:0===j.value.length,onClick:a[4]||(a[4]=e=>Q())},{default:c((()=>[d(l,null,{default:c((()=>[m("🗑️")])),_:1}),d(l,null,{default:c((()=>[m("删除")])),_:1})])),_:1},8,["disabled"])])),_:1}),d(t,{class:"list-container"},{default:c((()=>[D.value?(i(),u(t,{key:0,class:"loading-state"},{default:c((()=>[d(l,null,{default:c((()=>[m("加载中...")])),_:1})])),_:1})):0===U.value.length?(i(),u(t,{key:1,class:"empty-state"},{default:c((()=>[d(l,{class:"empty-icon"},{default:c((()=>[m("👤")])),_:1}),d(l,{class:"empty-text"},{default:c((()=>[m("暂无联系人数据")])),_:1})])),_:1})):(i(!0),g(h,{key:2},N(U.value,(e=>(i(),u(t,{key:e.id,class:"contact-card"},{default:c((()=>[d(t,{class:"card-header"},{default:c((()=>[d(l,{class:"contact-id"},{default:c((()=>[m("ID: "+_(e.id),1)])),_:2},1024),d(l,{class:"contact-name"},{default:c((()=>[m(_(e.name),1)])),_:2},1024)])),_:2},1024),d(t,{class:"card-content"},{default:c((()=>[d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("客户:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.customerName),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("职位:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.position),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("部门:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.department),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("手机:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.mobile),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("办公电话:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.phone),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("邮箱:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.email),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("微信号:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(e.wechat),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("主联系人:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(R(e.isPrimary)),1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-row"},{default:c((()=>[d(l,{class:"info-label"},{default:c((()=>[m("性别:")])),_:1}),d(l,{class:"info-value"},{default:c((()=>[m(_(W(e.gender)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(t,{class:"card-footer"},{default:c((()=>[d(t,{class:"time-info"},{default:c((()=>[d(l,null,{default:c((()=>[m("创建: "+_(e.createTime),1)])),_:2},1024),d(l,null,{default:c((()=>[m("更新: "+_(e.updateTime),1)])),_:2},1024)])),_:2},1024),d(t,{class:"action-buttons"},{default:c((()=>[d(k,{"v-has-perm":["aioveuContact:aioveu-contact:edit"],class:"action-btn edit",onClick:a=>L(e.id)},{default:c((()=>[d(l,null,{default:c((()=>[m("✏️")])),_:1}),d(l,null,{default:c((()=>[m("编辑")])),_:1})])),_:2},1032,["onClick"]),d(k,{"v-has-perm":["aioveuContact:aioveu-contact:delete"],class:"action-btn delete",onClick:a=>Q(e.id)},{default:c((()=>[d(l,null,{default:c((()=>[m("🗑️")])),_:1}),d(l,null,{default:c((()=>[m("删除")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),x.value>0?(i(),u(t,{key:3,class:"pagination"},{default:c((()=>[d(k,{class:"pagination-btn",disabled:S.pageNum<=1,onClick:G},{default:c((()=>[m(" 上一页 ")])),_:1},8,["disabled"]),d(l,{class:"page-info"},{default:c((()=>[m(_(S.pageNum)+" / "+_(Math.ceil(x.value/S.pageSize)),1)])),_:1}),d(k,{class:"pagination-btn",disabled:S.pageNum*S.pageSize>=x.value,onClick:H},{default:c((()=>[m(" 下一页 ")])),_:1},8,["disabled"])])),_:1})):f("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-bdca8d6d"]]);export{j as default};
