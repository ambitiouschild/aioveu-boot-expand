import{d as e,h as a,y as l,Y as s,z as t,a as u,w as i,$ as o,i as r,o as d,e as n,b as f,s as c,g as v,t as _,a4 as m,a6 as p,a0 as b,c as g,F as h,r as N,X as k,aa as w,aI as y,aJ as O}from"./index-5U173LQ3.js";import{A as C,a as I,b as A}from"./aioveu-warehouse.C1Qj9JK7.js";import{A as D}from"./aioveu-sales-order.NYwjDYB-.js";import{D as S}from"./dict.R0KYYCD_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=x(e({__name:"index",setup(e){const x=a(!1),j=a([]),z=a(0),P=a(!1),V=l({pageNum:1,pageSize:10}),M=a([]),T=a([]),$=a([]),q=a([]),B=a([]),E=a(-1),F=a(-1),J=a(-1),R=a(-1),U=a(void 0),W=()=>{P.value=!P.value},X=e=>{const a=e.detail.value;E.value=a,T.value[a]&&(V.orderName=T.value[a].salesOrderNo)},Y=e=>{const a=e.detail.value;F.value=a,$.value[a]&&(V.materialName=$.value[a].materialName)},Z=e=>{const a=e.detail.value;J.value=a,q.value[a]&&(V.warehouseName=q.value[a].warehouseName)},G=e=>{const a=e.detail.value;R.value=a,B.value[a]&&(V.status=Number(B.value[a].value))},H=()=>{x.value=!0,C.getPage(V).then((e=>{M.value=e.list,z.value=e.total})).catch((e=>{console.error("查询订单明细失败:",e),o({title:"加载数据失败",icon:"none"})})).finally((()=>{x.value=!1}))},K=()=>{V.pageNum=1,V.orderName="",V.materialName="",V.warehouseName="",V.status=void 0,E.value=-1,F.value=-1,J.value=-1,R.value=-1,M.value=[],H()},L=()=>{V.pageNum>1&&(V.pageNum--,H())},Q=()=>{V.pageNum*V.pageSize<z.value&&(V.pageNum++,H())},ee=a(!1);s((()=>{ee.value&&(H(),ee.value=!1)}));const ae=e=>{ee.value=!0,U.value=e;let a="/packageE/pages/aioveu_customer/sales_order_detail/form";void 0!==e&&(a+=`?id=${e}`),k({url:a})},le=e=>{const a=e?[e]:j.value;0!==a.length?w({title:"提示",content:"确认删除选中的订单明细吗？",success:e=>{e.confirm&&(y({title:"删除中..."}),C.deleteByIds(a.join(",")).then((()=>{o({title:"删除成功",icon:"success"}),K()})).catch((e=>{console.error("删除失败:",e),o({title:"删除失败",icon:"none"})})).finally((()=>O())))}}):o({title:"请选择要删除的订单明细",icon:"none"})},se=e=>{const a=B.value.find((a=>Number(a.value)===e));return a?a.label:"未知"};return t((()=>{H(),D.getAllSalesOrderOptions().then((e=>{Array.isArray(e)&&(T.value=e.map((e=>({salesOrderId:Number(e.salesOrderId),salesOrderNo:e.salesOrderNo}))))})).catch((e=>{console.error("加载销售订单选项失败:",e)})),I.getAllMaterialOptions().then((e=>{Array.isArray(e)&&($.value=e.map((e=>({materialId:Number(e.materialId),materialName:e.materialName}))))})).catch((e=>{console.error("加载物资选项失败:",e)})),A.getAllWarehouseOptions().then((e=>{Array.isArray(e)&&(q.value=e.map((e=>({warehouseId:Number(e.warehouseId),warehouseName:e.warehouseName}))))})).catch((e=>{console.error("加载仓库选项失败:",e)})),S.getDictItems("salesOrderDetail_status").then((e=>{B.value=e}))})),(e,a)=>{const l=c,s=r,t=m,o=p,k=b;return d(),u(s,{class:"app-container"},{default:i((()=>[n(s,{class:"search-container"},{default:i((()=>[n(s,{class:"filter-header",onClick:W},{default:i((()=>[n(l,null,{default:i((()=>[v("🔍 筛选条件")])),_:1}),n(l,null,{default:i((()=>[v(_(P.value?"▲":"▼"),1)])),_:1})])),_:1}),P.value?(d(),u(s,{key:0,class:"filter-content"},{default:i((()=>[n(s,{class:"filter-item"},{default:i((()=>[n(l,{class:"filter-label"},{default:i((()=>[v("明细ID")])),_:1}),n(t,{type:"text",class:"filter-input",placeholder:"请输入明细ID",modelValue:V.id,"onUpdate:modelValue":a[0]||(a[0]=e=>V.id=e),onConfirm:H},null,8,["modelValue"])])),_:1}),n(s,{class:"filter-item"},{default:i((()=>[n(l,{class:"filter-label"},{default:i((()=>[v("订单")])),_:1}),n(o,{class:"filter-picker",mode:"selector",range:T.value,"range-key":"salesOrderNo",value:E.value,onChange:X},{default:i((()=>[n(s,{class:"picker-view"},{default:i((()=>[v(_(E.value>=0?T.value[E.value].salesOrderNo:"请选择订单"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(s,{class:"filter-item"},{default:i((()=>[n(l,{class:"filter-label"},{default:i((()=>[v("物资")])),_:1}),n(o,{class:"filter-picker",mode:"selector",range:$.value,"range-key":"materialName",value:F.value,onChange:Y},{default:i((()=>[n(s,{class:"picker-view"},{default:i((()=>[v(_(F.value>=0?$.value[F.value].materialName:"请选择物资"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(s,{class:"filter-item"},{default:i((()=>[n(l,{class:"filter-label"},{default:i((()=>[v("发货仓库")])),_:1}),n(o,{class:"filter-picker",mode:"selector",range:q.value,"range-key":"warehouseName",value:J.value,onChange:Z},{default:i((()=>[n(s,{class:"picker-view"},{default:i((()=>[v(_(J.value>=0?q.value[J.value].warehouseName:"请选择发货仓库"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(s,{class:"filter-item"},{default:i((()=>[n(l,{class:"filter-label"},{default:i((()=>[v("明细状态")])),_:1}),n(o,{class:"filter-picker",mode:"selector",range:B.value,"range-key":"label",value:R.value,onChange:G},{default:i((()=>[n(s,{class:"picker-view"},{default:i((()=>[v(_(R.value>=0?B.value[R.value].label:"请选择明细状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),n(s,{class:"filter-buttons"},{default:i((()=>[n(k,{class:"filter-btn reset",onClick:K},{default:i((()=>[v("重置")])),_:1}),n(k,{class:"filter-btn confirm",onClick:H},{default:i((()=>[v("搜索")])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1}),n(s,{class:"action-buttons"},{default:i((()=>[n(k,{"v-has-perm":["aioveuSalesOrderDetail:aioveu-sales-order-detail:add"],class:"action-btn add",onClick:a[1]||(a[1]=e=>ae())},{default:i((()=>[n(l,null,{default:i((()=>[v("+")])),_:1}),n(l,null,{default:i((()=>[v("新增")])),_:1})])),_:1}),n(k,{"v-has-perm":["aioveuSalesOrderDetail:aioveu-sales-order-detail:delete"],class:"action-btn delete",disabled:0===j.value.length,onClick:a[2]||(a[2]=e=>le())},{default:i((()=>[n(l,null,{default:i((()=>[v("🗑️")])),_:1}),n(l,null,{default:i((()=>[v("删除")])),_:1})])),_:1},8,["disabled"])])),_:1}),n(s,{class:"list-container"},{default:i((()=>[x.value?(d(),u(s,{key:0,class:"loading-state"},{default:i((()=>[n(l,null,{default:i((()=>[v("加载中...")])),_:1})])),_:1})):0===M.value.length?(d(),u(s,{key:1,class:"empty-state"},{default:i((()=>[n(l,{class:"empty-icon"},{default:i((()=>[v("📋")])),_:1}),n(l,{class:"empty-text"},{default:i((()=>[v("暂无订单明细数据")])),_:1})])),_:1})):(d(!0),g(h,{key:2},N(M.value,(e=>(d(),u(s,{key:e.id,class:"detail-card"},{default:i((()=>[n(s,{class:"card-header"},{default:i((()=>[n(l,{class:"detail-id"},{default:i((()=>[v("ID: "+_(e.id),1)])),_:2},1024)])),_:2},1024),n(s,{class:"card-content"},{default:i((()=>[n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("订单:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.salesOrderNo),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("物资:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.materialName),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("数量:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.quantity),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("单价:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.unitPrice),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("折扣率:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.discount),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("税率:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.taxRate),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("小计:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.subtotal),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("税额:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.taxAmount),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("总金额:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.totalPrice),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("批次号:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.batchNumber),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("要求交货日期:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.deliveryDate),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("发货仓库:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.warehouseName),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("明细状态:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(se(e.status)),1)])),_:2},1024)])),_:2},1024),n(s,{class:"info-row"},{default:i((()=>[n(l,{class:"info-label"},{default:i((()=>[v("备注:")])),_:1}),n(l,{class:"info-value"},{default:i((()=>[v(_(e.notes),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(s,{class:"card-footer"},{default:i((()=>[n(s,{class:"time-info"},{default:i((()=>[n(l,null,{default:i((()=>[v("创建: "+_(e.createTime),1)])),_:2},1024),n(l,null,{default:i((()=>[v("更新: "+_(e.updateTime),1)])),_:2},1024)])),_:2},1024),n(s,{class:"action-buttons"},{default:i((()=>[n(k,{"v-has-perm":["aioveuSalesOrderDetail:aioveu-sales-order-detail:edit"],class:"action-btn edit",onClick:a=>ae(e.id)},{default:i((()=>[n(l,null,{default:i((()=>[v("✏️")])),_:1}),n(l,null,{default:i((()=>[v("编辑")])),_:1})])),_:2},1032,["onClick"]),n(k,{"v-has-perm":["aioveuSalesOrderDetail:aioveu-sales-order-detail:delete"],class:"action-btn delete",onClick:a=>le(e.id)},{default:i((()=>[n(l,null,{default:i((()=>[v("🗑️")])),_:1}),n(l,null,{default:i((()=>[v("删除")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),z.value>0?(d(),u(s,{key:3,class:"pagination"},{default:i((()=>[n(k,{class:"pagination-btn",disabled:V.pageNum<=1,onClick:L},{default:i((()=>[v(" 上一页 ")])),_:1},8,["disabled"]),n(l,{class:"page-info"},{default:i((()=>[v(_(V.pageNum)+" / "+_(Math.ceil(z.value/V.pageSize)),1)])),_:1}),n(k,{class:"pagination-btn",disabled:V.pageNum*V.pageSize>=z.value,onClick:Q},{default:i((()=>[v(" 下一页 ")])),_:1},8,["disabled"])])),_:1})):f("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-babf7acb"]]);export{j as default};
