import{d as e,h as a,y as l,al as o,$ as t,a as r,w as s,i,o as u,e as c,s as n,g as m,t as d,ay as f,a6 as p,a4 as v,a5 as y,a0 as _,aI as b,a3 as g,aJ as h}from"./index-5U173LQ3.js";import{A as k}from"./aioveu-performance.wTi-7WFQ.js";import{A as N}from"./aioveu-employee.CCWXpWw-.js";import{D as w}from"./dict.R0KYYCD_.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=I(e({__name:"form",setup(e){const I=a("新增绩效"),V=a(void 0),x=a(!1),C=l({employeeName:"",periodQuarter:void 0,kpiScore:void 0,productivity:void 0,review:""}),j=a([]),S=a([]),A=a([]),D=a(-1),Q=a(-1),K=a(-1);o((e=>{console.log("表单页参数:",e),U(),Y(),G(),e.id?(V.value=Number(e.id),I.value="编辑绩效",P()):I.value="新增绩效"}));const P=async()=>{if(V.value)try{x.value=!0;const e=await k.getFormData(V.value);if(Object.assign(C,e),C.employeeName){const e=j.value.findIndex((e=>e.employeeName===C.employeeName));D.value=e}if(void 0!==C.periodQuarter){const e=S.value.findIndex((e=>Number(e.value)===C.periodQuarter));Q.value=e}}catch(e){console.error("加载绩效数据失败:",e),t({title:"加载数据失败",icon:"none"})}finally{x.value=!1}},U=async()=>{try{const e=await N.getAllEmployeeOptions();Array.isArray(e)&&(j.value=e.map((e=>({employeeId:Number(e.employeeId),employeeName:e.employeeName}))))}catch(e){console.error("加载员工列表失败:",e),t({title:"加载员工列表失败",icon:"none"})}},Y=async()=>{try{const e=await w.getDictItems("performance_period_quarter");S.value=e}catch(e){console.error("加载季度选项失败:",e),t({title:"加载季度选项失败",icon:"none"})}},G=async()=>{try{const e=await w.getDictItems("performance_grade");A.value=e}catch(e){console.error("加载绩效等级失败:",e),t({title:"加载绩效等级失败",icon:"none"})}},O=e=>{const a=e.detail.value;D.value=a,j.value[a]&&(C.employeeName=j.value[a].employeeName)},q=e=>{const a=e.detail.value;Q.value=a,S.value[a]&&(C.periodQuarter=Number(S.value[a].value))},E=async()=>{if(F())try{b({title:"提交中..."}),V.value?(await k.update(V.value,C),t({title:"修改成功",icon:"success"})):(await k.add(C),t({title:"新增成功",icon:"success"})),g()}catch(e){console.error("提交表单失败:",e),t({title:"提交失败",icon:"none"})}finally{h()}},F=()=>C.employeeName?C.periodYear?void 0===C.periodQuarter?(t({title:"请选择考核季度",icon:"none"}),!1):C.kpiScore?C.kpiScore<1||C.kpiScore>100?(t({title:"KPI评分必须在1-100之间",icon:"none"}),!1):C.productivity?!(C.productivity<0||C.productivity>100)||(t({title:"生产率必须在0-100之间",icon:"none"}),!1):(t({title:"请输入生产率",icon:"none"}),!1):(t({title:"请输入KPI评分",icon:"none"}),!1):(t({title:"请输入考核年份",icon:"none"}),!1):(t({title:"请选择员工",icon:"none"}),!1),J=()=>{g()};return(e,a)=>{const l=n,o=i,t=p,b=v,g=y,h=f,k=_;return u(),r(o,{class:"form-container"},{default:s((()=>[c(o,{class:"form-header"},{default:s((()=>[c(l,{class:"form-title"},{default:s((()=>[m(d(I.value),1)])),_:1})])),_:1}),c(h,{class:"form-body scroll-y","scroll-y":""},{default:s((()=>[c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("员工")])),_:1}),c(t,{class:"form-picker",mode:"selector",range:j.value,"range-key":"employeeName",value:D.value,onChange:O},{default:s((()=>[c(o,{class:"picker-view"},{default:s((()=>[m(d(D.value>=0?j.value[D.value].employeeName:"请选择员工"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("考核年份")])),_:1}),c(b,{type:"number",class:"form-input",placeholder:"请输入考核年份",modelValue:C.periodYear,"onUpdate:modelValue":a[0]||(a[0]=e=>C.periodYear=e)},null,8,["modelValue"])])),_:1}),c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("考核季度")])),_:1}),c(t,{class:"form-picker",mode:"selector",range:S.value,"range-key":"label",value:Q.value,onChange:q},{default:s((()=>[c(o,{class:"picker-view"},{default:s((()=>[m(d(Q.value>=0?S.value[Q.value].label:"请选择季度"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("KPI评分")])),_:1}),c(b,{type:"number",class:"form-input",placeholder:"请输入KPI评分(1-100)",modelValue:C.kpiScore,"onUpdate:modelValue":a[1]||(a[1]=e=>C.kpiScore=e),min:"1",max:"100"},null,8,["modelValue"])])),_:1}),c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("生产率")])),_:1}),c(b,{type:"number",class:"form-input",placeholder:"请输入生产率百分比(%)",modelValue:C.productivity,"onUpdate:modelValue":a[2]||(a[2]=e=>C.productivity=e),min:"0",max:"100"},null,8,["modelValue"])])),_:1}),c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("主管评语")])),_:1}),c(g,{class:"form-textarea",placeholder:"请输入主管评语",modelValue:C.review,"onUpdate:modelValue":a[3]||(a[3]=e=>C.review=e)},null,8,["modelValue"])])),_:1}),c(o,{class:"form-item"},{default:s((()=>[c(l,{class:"form-label"},{default:s((()=>[m("绩效等级")])),_:1}),c(t,{class:"form-picker",mode:"selector",range:A.value,"range-key":"label",value:K.value,onChange:e.onGradeChange},{default:s((()=>[c(o,{class:"picker-view"},{default:s((()=>[m(d(K.value>=0?A.value[K.value].label:"请选择绩效等级"),1)])),_:1})])),_:1},8,["range","value","onChange"])])),_:1})])),_:1}),c(o,{class:"form-footer"},{default:s((()=>[c(k,{class:"form-btn cancel",onClick:J},{default:s((()=>[m("取消")])),_:1}),c(k,{class:"form-btn confirm",onClick:E},{default:s((()=>[m("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-90b34dd8"]]);export{V as default};
