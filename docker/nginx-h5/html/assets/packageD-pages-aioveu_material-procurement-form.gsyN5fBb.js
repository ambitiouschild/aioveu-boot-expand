import{d as e,h as a,y as l,al as t,aI as r,$ as u,aJ as o,l as s,a as i,w as n,i as d,E as m,G as c,o as f,e as v,s as p,g as _,t as D,ay as w,a4 as g,a6 as b,a5 as y,a0 as k,a3 as h}from"./index-5U173LQ3.js";import{_ as x}from"./wd-datetime-picker.BfyXiKcO.js";import{A as N}from"./aioveu-procurement.sqKFhiud.js";import{D as j}from"./dict.R0KYYCD_.js";import{A as S}from"./aioveu-material.D870okzX.js";import{A as V}from"./aioveu-warehouse.DBFoddqK.js";import{A as C}from"./aioveu-employee.BSG7yiTE.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-picker-view.C4DkyJ3f.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./dayjs.CSix6rHa.js";const q=I(e({__name:"form",setup(e){const I=a("新增采购流程"),q=a(void 0),$=l({}),A=a([]),T=a([]),M=a([]),U=a([]),P=a(-1),O=a(-1),F=a(-1),E=a(-1),H=a(-1);t((e=>{J(),L(),W(),z(),e&&e.id?(q.value=Number(e.id),I.value="编辑采购流程",Y(Number(e.id))):I.value="新增采购流程"}));const Y=async e=>{try{r({title:"加载中..."});const a=await N.getFormData(e);Object.assign($,{...a,orderDate:a.orderDate?new Date(a.orderDate):new Date,receiptDate:a.receiptDate?new Date(a.receiptDate):new Date,inboundDate:a.inboundDate?new Date(a.inboundDate):new Date,reviewTime:a.reviewTime?new Date(a.reviewTime):new Date}),G()}catch(a){console.error("加载采购数据失败:",a),u({title:"加载数据失败",icon:"none"})}finally{o()}},G=()=>{if($.materialName){const e=T.value.findIndex((e=>e.value===$.materialName));P.value=e}if($.warehouseName){const e=M.value.findIndex((e=>e.value===$.warehouseName));O.value=e}if(void 0!==$.status){const e=A.value.findIndex((e=>e.value===$.status));F.value=e}if($.applicantName){const e=U.value.findIndex((e=>e.value===$.applicantName));E.value=e}if($.reviewerName){const e=U.value.findIndex((e=>e.value===$.reviewerName));H.value=e}},J=()=>{j.getDictItems("procurement_status").then((e=>{A.value=e.map((e=>({value:Number(e.value),text:e.label})))}))},L=()=>{S.getAllMaterialOptions().then((e=>{T.value=e.map((e=>({value:e.materialName,text:e.materialName})))}))},W=()=>{V.getAllWarehouseOptions().then((e=>{M.value=e.map((e=>({value:e.warehouseName,text:e.warehouseName})))}))},z=()=>{C.getAllEmployeeOptions().then((e=>{U.value=e.map((e=>({value:e.employeeName,text:e.employeeName})))}))},B=e=>{const a=e.detail.value;P.value=a,T.value[a]&&($.materialName=T.value[a].value)},K=e=>{const a=e.detail.value;O.value=a,M.value[a]&&($.warehouseName=M.value[a].value)},Q=e=>{const a=e.detail.value;F.value=a,A.value[a]&&($.status=A.value[a].value)},R=e=>{const a=e.detail.value;E.value=a,U.value[a]&&($.applicantName=U.value[a].value)},X=e=>{const a=e.detail.value;H.value=a,U.value[a]&&($.reviewerName=U.value[a].value)},Z=e=>{$.orderDate=new Date(e.value)},ee=e=>{$.expectedDelivery=e.detail.value},ae=e=>{$.actualDelivery=e.detail.value},le=e=>{$.receiptDate=new Date(e.value)},te=e=>{$.inboundDate=new Date(e.value)},re=e=>{$.reviewTime=new Date(e.value)},ue=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},oe=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},se=s((()=>({...$,orderDate:oe($.orderDate),receiptDate:oe($.receiptDate),inboundDate:oe($.inboundDate),reviewTime:oe($.reviewTime)}))),ie=async()=>{if(ne())try{r({title:"提交中..."});const e=q.value,a=se.value;e?(await N.update(e,a),u({title:"修改成功",icon:"success"})):(await N.add(a),u({title:"新增成功",icon:"success"})),h()}catch(e){console.error("提交表单失败:",e),u({title:"提交失败",icon:"none"})}finally{o()}},ne=()=>$.procurementNo?$.supplierId?$.materialName?$.quantity?$.unitPrice?$.totalAmount?$.orderDate?$.warehouseName?void 0===$.status?(u({title:"请选择状态",icon:"none"}),!1):!!$.applicantName||(u({title:"请选择申请人",icon:"none"}),!1):(u({title:"请选择入库仓库",icon:"none"}),!1):(u({title:"请选择下单时间",icon:"none"}),!1):(u({title:"请输入总金额",icon:"none"}),!1):(u({title:"请输入采购单价",icon:"none"}),!1):(u({title:"请输入采购数量",icon:"none"}),!1):(u({title:"请选择物资",icon:"none"}),!1):(u({title:"请输入供应商ID",icon:"none"}),!1):(u({title:"请输入采购单号",icon:"none"}),!1),de=()=>{h()};return(e,a)=>{const l=p,t=d,r=g,u=b,o=m(c("wd-datetime-picker"),x),s=y,h=w,N=k;return f(),i(t,{class:"form-container"},{default:n((()=>[v(t,{class:"form-header"},{default:n((()=>[v(l,{class:"form-title"},{default:n((()=>[_(D(I.value),1)])),_:1})])),_:1}),v(h,{class:"form-body scroll-y","scroll-y":""},{default:n((()=>[v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("采购单号")])),_:1}),v(r,{type:"text",class:"form-input",placeholder:"请输入采购单号",modelValue:$.procurementNo,"onUpdate:modelValue":a[0]||(a[0]=e=>$.procurementNo=e)},null,8,["modelValue"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("供应商ID")])),_:1}),v(r,{type:"text",class:"form-input",placeholder:"请输入供应商ID",modelValue:$.supplierId,"onUpdate:modelValue":a[1]||(a[1]=e=>$.supplierId=e)},null,8,["modelValue"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("物资")])),_:1}),v(u,{class:"form-picker",mode:"selector",range:T.value,"range-key":"text",value:P.value,onChange:B},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D(P.value>=0?T.value[P.value].text:"请选择物资"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("采购数量")])),_:1}),v(r,{type:"number",class:"form-input",placeholder:"请输入采购数量",modelValue:$.quantity,"onUpdate:modelValue":a[2]||(a[2]=e=>$.quantity=e)},null,8,["modelValue"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("采购单价")])),_:1}),v(r,{type:"number",class:"form-input",placeholder:"请输入采购单价",modelValue:$.unitPrice,"onUpdate:modelValue":a[3]||(a[3]=e=>$.unitPrice=e)},null,8,["modelValue"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("总金额")])),_:1}),v(r,{type:"number",class:"form-input",placeholder:"请输入总金额",modelValue:$.totalAmount,"onUpdate:modelValue":a[4]||(a[4]=e=>$.totalAmount=e)},null,8,["modelValue"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("下单时间")])),_:1}),v(o,{class:"form-picker",mode:"datetime",value:$.orderDate,"default-value":new Date,onConfirm:Z},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D($.orderDate?ue($.orderDate):"请选择下单时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("预计到货日期")])),_:1}),v(u,{class:"form-picker",mode:"date",value:$.expectedDelivery,onChange:ee},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D($.expectedDelivery||"请选择预计到货日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("实际到货日期")])),_:1}),v(u,{class:"form-picker",mode:"date",value:$.actualDelivery,onChange:ae},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D($.actualDelivery||"请选择实际到货日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("签收时间")])),_:1}),v(o,{class:"form-picker",mode:"date",value:$.receiptDate,"default-value":new Date,onConfirm:le},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D($.receiptDate?ue($.receiptDate):"请选择签收时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("入库仓库")])),_:1}),v(u,{class:"form-picker",mode:"selector",range:M.value,"range-key":"text",value:O.value,onChange:K},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D(O.value>=0?M.value[O.value].text:"请选择入库仓库"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("入库时间")])),_:1}),v(o,{class:"form-picker",mode:"date",value:$.inboundDate,"default-value":new Date,onConfirm:te},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D($.inboundDate?ue($.inboundDate):"请选择入库时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("状态")])),_:1}),v(u,{class:"form-picker",mode:"selector",range:A.value,"range-key":"text",value:F.value,onChange:Q},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D(F.value>=0?A.value[F.value].text:"请选择状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label required"},{default:n((()=>[_("申请人")])),_:1}),v(u,{class:"form-picker",mode:"selector",range:U.value,"range-key":"text",value:E.value,onChange:R},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D(E.value>=0?U.value[E.value].text:"请选择申请人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("审核人")])),_:1}),v(u,{class:"form-picker",mode:"selector",range:U.value,"range-key":"text",value:H.value,onChange:X},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D(H.value>=0?U.value[H.value].text:"请选择审核人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("审核时间")])),_:1}),v(o,{class:"form-picker",mode:"date",value:$.reviewTime,"default-value":new Date,onConfirm:re},{default:n((()=>[v(t,{class:"picker-view"},{default:n((()=>[_(D($.reviewTime?ue($.reviewTime):"请选择审核时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),v(t,{class:"form-item"},{default:n((()=>[v(l,{class:"form-label"},{default:n((()=>[_("备注")])),_:1}),v(s,{class:"form-textarea",placeholder:"请输入备注",modelValue:$.remark,"onUpdate:modelValue":a[5]||(a[5]=e=>$.remark=e)},null,8,["modelValue"])])),_:1})])),_:1}),v(t,{class:"form-footer"},{default:n((()=>[v(N,{class:"form-btn cancel",onClick:de},{default:n((()=>[_("取消")])),_:1}),v(N,{class:"form-btn confirm",onClick:ie},{default:n((()=>[_("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-1e371c1e"]]);export{q as default};
