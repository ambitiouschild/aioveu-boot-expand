import{d as e,h as a,k as l,j as n,a as t,o,i as s,f as u,n as i,w as r,b as c,e as d,aK as v,c as m,r as h,aL as p,F as f,g,t as y,C as w}from"./index-5U173LQ3.js";import{w as b}from"./wd-overlay.iGBdgU4M.js";import{c as _,x as k,b as x,m as C,a as K,j as $,N as I,i as S,z as j,O as E,C as O,f as P}from"./wd-icon.CDbxLjoy.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";function D(e,a,l){let n=$(e)?e:[e];const t=new Set(e.map(I));if(1!==t.size&&t.has("object"))throw Error("The columns are correct");$(e[0])||(n=[n]);return n.map((e=>e.map((e=>{if(!S(e))return{[a]:e,[l]:e};if(!e.hasOwnProperty(a)&&!e.hasOwnProperty(l))throw Error("Can't find valueKey and labelKey in columns");return e.hasOwnProperty(l)||(e[l]=e[a]),e.hasOwnProperty(a)||(e[a]=e[l]),e}))))}const H=V(e({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{..._,loading:x(!1),loadingColor:C("#4D80F0"),columnsHeight:K(217),valueKey:C("value"),labelKey:C("label"),immediateChange:x(!1),modelValue:{type:[String,Number,Boolean,Array,Array,Array],default:"",required:!0},columns:k(),columnChange:Function},emits:["change","pickstart","pickend","update:modelValue"],setup(e,{expose:_,emit:k}){const x=e,C=k,K=a([]),S=a(35),V=a([]);l([()=>x.modelValue,()=>x.columns],((e,a)=>{O(a[1],e[1])||($(e[1])&&e[1].length>0?K.value=D(e[1],x.valueKey,x.labelKey):(K.value=[],V.value=[])),P(e[0])&&function(e){if(0===K.value.length)return void(V.value=[]);(""===e||!P(e)||$(e)&&0===e.length)&&(e=K.value.map((e=>e[0][x.valueKey])));const a=I(e),l=["string","number","boolean","array"];-1===l.indexOf(a)&&console.error(`value must be one of ${l.toString()}`);e=(e=$(e)?e:[e]).slice(0,K.value.length);let n=j(V.value);e.forEach(((e,a)=>{let l=K.value[a].findIndex((a=>a[x.valueKey].toString()===e.toString()));l=-1===l?0:l,n=A(a,l,n)})),V.value=n.slice(0,e.length)}(e[0])}),{deep:!0,immediate:!0});const{proxy:H}=n();function A(e,a,l){const n=K.value[e];if(!n||!n[a])throw Error(`The value to select with Col:${e} Row:${a} is incorrect`);const t=j(l);if(t[e]=a,n[a].disabled){const l=n.slice(0,a).reverse().findIndex((e=>!e.disabled)),o=n.slice(a+1).findIndex((e=>!e.disabled));-1!==l?t[e]=a-1-l:-1!==o?t[e]=a+1+o:void 0===t[e]&&(t[e]=0)}return t}function F({detail:{value:e}}){const a=function(e){e=e.slice(0,K.value.length);const a=j(V.value);let l=j(V.value);e.forEach(((e,n)=>{(e=E(e,0,K.value[n].length-1))!==a[n]&&(l=A(n,e,l))}));const n=function(e,a){if(!e||!a)return-1;const l=e.findIndex(((e,l)=>e!==a[l]));return l}(l,a);if(-1===n)return;const t=l[n];return 1===l.length?t:n}(e=e.map((e=>Number(e||0))));V.value=j(e),w((()=>{V.value=function(e){let a=j(e);return e.forEach(((e,l)=>{e=E(e,0,K.value[l].length-1),a=A(l,e,a)})),a}(e),x.columnChange?x.columnChange.length<4?(x.columnChange(H.$.exposed,T(),a||0,(()=>{})),N(a||0)):x.columnChange(H.$.exposed,T(),a||0,(()=>{N(a||0)})):N(a||0)}))}function N(e){const a=z();O(a,x.modelValue)||(C("update:modelValue",a),setTimeout((()=>{C("change",{picker:H.$.exposed,value:a,index:e})}),0))}function T(){const e=V.value.map(((e,a)=>K.value[a][e]));return 1===e.length?e[0]:e}function z(){const{valueKey:e}=x,a=V.value.map(((a,l)=>K.value[l][a][e]));return 1===a.length?a[0]:a}function L(){C("pickstart")}function q(){C("pickend")}return _({getSelects:T,getValues:z,setColumnData:function(e,a,l=0){K.value[e]=D(a,x.valueKey,x.labelKey).reduce(((e,a)=>e.concat(a)),[]),V.value=A(e,l,V.value)},getColumnsData:function(){return j(K.value)},getColumnData:function(e){return K.value[e]},getColumnIndex:function(e){return V.value[e]},getLabels:function(){const{labelKey:e}=x;return V.value.map(((a,l)=>K.value[l][a][e]))},getSelectedIndex:function(){return V.value},resetColumns:function(e){$(e)&&e.length&&(K.value=D(e,x.valueKey,x.labelKey))}}),(e,a)=>{const l=s,n=p,w=v;return o(),t(l,{class:i(`wd-picker-view ${e.customClass}`),style:u(e.customStyle)},{default:r((()=>[e.loading?(o(),t(l,{key:0,class:"wd-picker-view__loading"},{default:r((()=>[d(b,{color:e.loadingColor},null,8,["color"])])),_:1})):c("",!0),d(l,{style:u(`height: ${e.columnsHeight-20}px;`)},{default:r((()=>[d(w,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${S.value}px;`,style:u(`height: ${e.columnsHeight-20}px;`),value:V.value,"immediate-change":e.immediateChange,onChange:F,onPickstart:L,onPickend:q},{default:r((()=>[(o(!0),m(f,null,h(K.value,((a,s)=>(o(),t(n,{key:s,class:"wd-picker-view-column"},{default:r((()=>[(o(!0),m(f,null,h(a,((a,n)=>(o(),t(l,{key:n,class:i(`wd-picker-view-column__item ${a.disabled?"wd-picker-view-column__item--disabled":""}  ${V.value[s]==n?"wd-picker-view-column__item--active":""}`),style:u(`line-height: ${S.value}px;`)},{default:r((()=>[g(y(a[e.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value","immediate-change"])])),_:1},8,["style"])])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-e413638e"]]);export{H as w};
