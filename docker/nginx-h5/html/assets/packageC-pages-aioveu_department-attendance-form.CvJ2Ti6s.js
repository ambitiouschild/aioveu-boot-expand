import{d as e,h as a,y as t,al as l,a as s,w as o,i as c,o as u,e as i,s as r,g as n,t as m,ay as d,a6 as f,a0 as v,a4 as p,$ as k,aI as _,a3 as g,aJ as y}from"./index-5U173LQ3.js";import{A as h}from"./aioveu-attendance.DrlmBXaU.js";import{A as T}from"./aioveu-employee.CCWXpWw-.js";import{D as b}from"./dict.R0KYYCD_.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=N(e({__name:"form",setup(e){const N=a("新增考勤"),S=a(void 0),w=a(!1),$=t({employeeName:"",date:"",checkinTime:"",checkoutTime:"",workHours:void 0,status:void 0}),H=a([]),I=a([]),D=a(-1),j=a(-1);l((e=>{if(console.log("页面参数:",e),x(),A(),e.attendanceId)S.value=Number(e.attendanceId),N.value="编辑考勤",C();else{N.value="新增考勤";const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");$.date=`${a}-${t}-${l}`}}));const C=()=>{S.value&&(w.value=!0,h.getFormData(S.value).then((e=>{var a,t;if($.employeeName=e.employeeName||"",$.date=e.date||"",e.checkinTime){const t=null==(a=e.checkinTime.split("T")[1])?void 0:a.split(":").slice(0,2).join(":");$.checkinTime=t||""}if(e.checkoutTime){const a=null==(t=e.checkoutTime.split("T")[1])?void 0:t.split(":").slice(0,2).join(":");$.checkoutTime=a||""}if($.workHours=e.workHours?Number(e.workHours):void 0,$.status=e.status,$.employeeName){const e=H.value.findIndex((e=>e.employeeName===$.employeeName));D.value=e}if(void 0!==$.status){const e=I.value.findIndex((e=>{var a;return e.value===(null==(a=$.status)?void 0:a.toString())}));j.value=e}})).finally((()=>{w.value=!1})))},x=()=>{T.getAllEmployeeOptions().then((e=>{Array.isArray(e)&&(H.value=e.map((e=>({employeeId:Number(e.employeeId),employeeName:e.employeeName}))))}))},A=()=>{b.getDictItems("attendance_status").then((e=>{I.value=e}))},M=e=>{const a=e.detail.value;D.value=a,H.value[a]&&($.employeeName=H.value[a].employeeName)},V=e=>{$.date=e.detail.value},F=()=>{const e=new Date,a=String(e.getHours()).padStart(2,"0"),t=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");$.checkinTime=`${a}:${t}:${l}`,k({title:"上班打卡成功",icon:"success"})},E=()=>{const e=new Date,a=String(e.getHours()).padStart(2,"0"),t=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");$.checkoutTime=`${a}:${t}:${l}`,k({title:"下班打卡成功",icon:"success"})},G=e=>{const a=e.detail.value;j.value=a,I.value[a]&&($.status=Number(I.value[a].value))},J=e=>e?e.substring(0,8):"",O=()=>{if(!U())return;_({title:"提交中..."});const e={employeeName:$.employeeName,date:$.date,checkinTime:$.checkinTime?`${$.date} ${$.checkinTime}`:void 0,checkoutTime:$.checkoutTime?`${$.date} ${$.checkoutTime}`:void 0,workHours:$.workHours,status:$.status};S.value?h.update(S.value,e).then((()=>{k({title:"修改成功",icon:"success"}),g()})).finally((()=>y())):h.add(e).then((()=>{k({title:"新增成功",icon:"success"}),g()})).finally((()=>y()))},U=()=>$.employeeName?$.date?void 0===$.workHours||null===$.workHours?(k({title:"请输入工作时长",icon:"none"}),!1):void 0!==$.status||(k({title:"请选择考勤状态",icon:"none"}),!1):(k({title:"请选择日期",icon:"none"}),!1):(k({title:"请选择员工",icon:"none"}),!1),Y=()=>{g()};return(e,a)=>{const t=r,l=c,k=f,_=v,g=p,y=d;return u(),s(l,{class:"form-container"},{default:o((()=>[i(l,{class:"form-header"},{default:o((()=>[i(t,{class:"form-title"},{default:o((()=>[n(m(N.value),1)])),_:1})])),_:1}),i(y,{class:"form-body scroll-y","scroll-y":""},{default:o((()=>[i(l,{class:"form-item"},{default:o((()=>[i(t,{class:"form-label"},{default:o((()=>[n("员工姓名")])),_:1}),i(k,{class:"form-picker",mode:"selector",range:H.value,"range-key":"employeeName",value:D.value,onChange:M},{default:o((()=>[i(l,{class:"picker-view"},{default:o((()=>[n(m(D.value>=0?H.value[D.value].employeeName:"请选择员工"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(l,{class:"form-item"},{default:o((()=>[i(t,{class:"form-label"},{default:o((()=>[n("日期")])),_:1}),i(k,{class:"form-picker",mode:"date",value:$.date,onChange:V},{default:o((()=>[i(l,{class:"picker-view"},{default:o((()=>[n(m($.date||"请选择日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),i(l,{class:"form-item"},{default:o((()=>[i(t,{class:"form-label"},{default:o((()=>[n("上班打卡时间")])),_:1}),i(l,{class:"time-record-container"},{default:o((()=>[i(_,{class:"record-btn",onClick:F},{default:o((()=>[n("上班打卡")])),_:1}),i(t,{class:"time-display"},{default:o((()=>[n(m($.checkinTime?J($.checkinTime):"未打卡"),1)])),_:1})])),_:1})])),_:1}),i(l,{class:"form-item"},{default:o((()=>[i(t,{class:"form-label"},{default:o((()=>[n("下班打卡时间")])),_:1}),i(l,{class:"time-record-container"},{default:o((()=>[i(_,{class:"record-btn",onClick:E},{default:o((()=>[n("下班打卡")])),_:1}),i(t,{class:"time-display"},{default:o((()=>[n(m($.checkoutTime?J($.checkoutTime):"未打卡"),1)])),_:1})])),_:1})])),_:1}),i(l,{class:"form-item"},{default:o((()=>[i(t,{class:"form-label"},{default:o((()=>[n("工作时长(小时)")])),_:1}),i(g,{type:"number",class:"form-input",placeholder:"请输入工作时长",modelValue:$.workHours,"onUpdate:modelValue":a[0]||(a[0]=e=>$.workHours=e)},null,8,["modelValue"])])),_:1}),i(l,{class:"form-item"},{default:o((()=>[i(t,{class:"form-label"},{default:o((()=>[n("考勤状态")])),_:1}),i(k,{class:"form-picker",mode:"selector",range:I.value,"range-key":"label",value:j.value,onChange:G},{default:o((()=>[i(l,{class:"picker-view"},{default:o((()=>[n(m(j.value>=0?I.value[j.value].label:"请选择状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1}),i(l,{class:"form-footer"},{default:o((()=>[i(_,{class:"form-btn cancel",onClick:Y},{default:o((()=>[n("取消")])),_:1}),i(_,{class:"form-btn confirm",onClick:O},{default:o((()=>[n("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-2781b35b"]]);export{S as default};
