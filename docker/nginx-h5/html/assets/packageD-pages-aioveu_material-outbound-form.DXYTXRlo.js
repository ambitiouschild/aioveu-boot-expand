import{d as e,h as a,y as t,al as l,$ as u,l as o,a as r,w as s,i,E as n,G as m,o as d,e as c,s as v,g as f,t as p,ay as g,a4 as _,a6 as N,a5 as h,a0 as b,aI as x,a3 as y,aJ as w}from"./index-5U173LQ3.js";import{_ as j}from"./wd-datetime-picker.BfyXiKcO.js";import{A as k}from"./aioveu-outbound.BtRxSKMm.js";import{D as S}from"./dict.R0KYYCD_.js";import{A as V}from"./aioveu-material.D870okzX.js";import{A as D}from"./aioveu-warehouse.DBFoddqK.js";import{A as I}from"./aioveu-department.N5KmT_PM.js";import{A as $}from"./aioveu-employee.BSG7yiTE.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-picker-view.C4DkyJ3f.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./dayjs.CSix6rHa.js";const T=q(e({__name:"form",setup(e){const q=a("新增出库记录"),T=a(void 0),A=t({}),C=a([]),M=a([]),U=a([]),O=a([]),F=a([]),E=a(-1),H=a(-1),P=a(-1),Y=a(-1),G=a(-1),J=a(-1);l((e=>{z(),B(),K(),Q(),R(),e&&e.id?(T.value=Number(e.id),q.value="编辑出库记录",L(Number(e.id))):q.value="新增出库记录"}));const L=async e=>{try{const a=await k.getFormData(e);Object.assign(A,{...a,outTime:a.outTime?new Date(a.outTime):new Date}),W()}catch(a){console.error("加载出库数据失败:",a),u({title:"加载数据失败",icon:"none"})}},W=()=>{if(A.materialName){const e=M.value.findIndex((e=>e.value===A.materialName));E.value=e}if(A.warehouseName){const e=U.value.findIndex((e=>e.value===A.warehouseName));H.value=e}if(A.departmentName){const e=O.value.findIndex((e=>e.value===A.departmentName));P.value=e}if(A.operatorName){const e=F.value.findIndex((e=>e.value===A.operatorName));Y.value=e}if(A.recipientName){const e=F.value.findIndex((e=>e.value===A.recipientName));G.value=e}if(void 0!==A.status){const e=C.value.findIndex((e=>e.value===A.status));J.value=e}},z=()=>{S.getDictItems("outbound_status").then((e=>{C.value=e.map((e=>({value:Number(e.value),text:e.label})))}))},B=()=>{V.getAllMaterialOptions().then((e=>{M.value=e.map((e=>({value:e.materialName,text:e.materialName})))}))},K=()=>{D.getAllWarehouseOptions().then((e=>{U.value=e.map((e=>({value:e.warehouseName,text:e.warehouseName})))}))},Q=()=>{I.getAllDepartmentOptions().then((e=>{O.value=e.map((e=>({value:e.deptName,text:e.deptName})))}))},R=()=>{$.getAllEmployeeOptions().then((e=>{F.value=e.map((e=>({value:e.employeeName,text:e.employeeName})))}))},X=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},Z=e=>{const a=e.detail.value;E.value=a,M.value[a]&&(A.materialName=M.value[a].value)},ee=e=>{const a=e.detail.value;H.value=a,U.value[a]&&(A.warehouseName=U.value[a].value)},ae=e=>{const a=e.detail.value;P.value=a,O.value[a]&&(A.departmentName=O.value[a].value)},te=e=>{const a=e.detail.value;Y.value=a,F.value[a]&&(A.operatorName=F.value[a].value)},le=e=>{const a=e.detail.value;G.value=a,F.value[a]&&(A.recipientName=F.value[a].value)},ue=e=>{const a=e.detail.value;J.value=a,C.value[a]&&(A.status=C.value[a].value)},oe=e=>{A.outTime=new Date(e.value)},re=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},se=o((()=>({...A,outTime:re(A.outTime)}))),ie=async()=>{if(ne())try{x({title:"提交中..."});const e=T.value,a=se.value;e?(await k.update(e,a),u({title:"修改成功",icon:"success"})):(await k.add(a),u({title:"新增成功",icon:"success"})),y()}catch(e){console.error("提交表单失败:",e),u({title:"提交失败",icon:"none"})}finally{w()}},ne=()=>A.outboundNo?A.materialName?A.warehouseName?A.quantity?A.outTime?A.operatorName?A.recipientName?A.departmentName?void 0!==A.status||(u({title:"请选择状态",icon:"none"}),!1):(u({title:"请选择领用部门",icon:"none"}),!1):(u({title:"请选择领用人",icon:"none"}),!1):(u({title:"请选择操作员",icon:"none"}),!1):(u({title:"请选择出库时间",icon:"none"}),!1):(u({title:"请输入出库数量",icon:"none"}),!1):(u({title:"请选择仓库",icon:"none"}),!1):(u({title:"请选择物资",icon:"none"}),!1):(u({title:"请输入出库单号",icon:"none"}),!1),me=()=>{y()};return(e,a)=>{const t=v,l=i,u=_,o=N,x=n(m("wd-datetime-picker"),j),y=h,w=g,k=b;return d(),r(l,{class:"form-container"},{default:s((()=>[c(l,{class:"form-header"},{default:s((()=>[c(t,{class:"form-title"},{default:s((()=>[f(p(q.value),1)])),_:1})])),_:1}),c(w,{class:"form-body scroll-y","scroll-y":""},{default:s((()=>[c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("出库单号")])),_:1}),c(u,{type:"text",class:"form-input",placeholder:"请输入出库单号",modelValue:A.outboundNo,"onUpdate:modelValue":a[0]||(a[0]=e=>A.outboundNo=e)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("物资")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:M.value,"range-key":"text",value:E.value,onChange:Z},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(E.value>=0?M.value[E.value].text:"请选择物资"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("仓库")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:U.value,"range-key":"text",value:H.value,onChange:ee},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(H.value>=0?U.value[H.value].text:"请选择仓库"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("出库数量")])),_:1}),c(u,{type:"number",class:"form-input",placeholder:"请输入出库数量",modelValue:A.quantity,"onUpdate:modelValue":a[1]||(a[1]=e=>A.quantity=e)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label"},{default:s((()=>[f("批次号")])),_:1}),c(u,{type:"text",class:"form-input",placeholder:"请输入批次号",modelValue:A.batchNumber,"onUpdate:modelValue":a[2]||(a[2]=e=>A.batchNumber=e)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("出库时间")])),_:1}),c(x,{class:"form-picker",mode:"date",value:A.outTime,"default-value":new Date,onConfirm:oe},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(A.outTime?X(A.outTime):"请选择出库时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("操作员")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:F.value,"range-key":"text",value:Y.value,onChange:te},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(Y.value>=0?F.value[Y.value].text:"请选择操作员"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("领用人")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:F.value,"range-key":"text",value:G.value,onChange:le},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(G.value>=0?F.value[G.value].text:"请选择领用人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("领用部门")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:O.value,"range-key":"text",value:P.value,onChange:ae},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(P.value>=0?O.value[P.value].text:"请选择领用部门"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label"},{default:s((()=>[f("用途说明")])),_:1}),c(y,{class:"form-textarea",placeholder:"请输入用途说明",modelValue:A.purpose,"onUpdate:modelValue":a[3]||(a[3]=e=>A.purpose=e)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label"},{default:s((()=>[f("关联项目ID")])),_:1}),c(u,{type:"text",class:"form-input",placeholder:"请输入关联项目ID",modelValue:A.projectId,"onUpdate:modelValue":a[4]||(a[4]=e=>A.projectId=e)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:s((()=>[c(t,{class:"form-label required"},{default:s((()=>[f("状态")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:C.value,"range-key":"text",value:J.value,onChange:ue},{default:s((()=>[c(l,{class:"picker-view"},{default:s((()=>[f(p(J.value>=0?C.value[J.value].text:"请选择状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1}),c(l,{class:"form-footer"},{default:s((()=>[c(k,{class:"form-btn cancel",onClick:me},{default:s((()=>[f("取消")])),_:1}),c(k,{class:"form-btn confirm",onClick:ie},{default:s((()=>[f("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-838eaff2"]]);export{T as default};
