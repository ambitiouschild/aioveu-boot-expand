import{d as e,h as a,y as l,al as t,$ as o,a as s,w as n,i as r,o as u,e as c,s as d,g as i,t as m,ay as f,a4 as v,a6 as p,a5 as _,a0 as y,aI as g,a3 as b,aJ as h}from"./index-5U173LQ3.js";import{A as x}from"./aioveu-equipment.Cs6gwxur.js";import{D as V}from"./dict.R0KYYCD_.js";import{A as k}from"./aioveu-department.N5KmT_PM.js";import{A as I}from"./aioveu-category.DEnk_6py.js";import{A as N}from"./aioveu-employee.BSG7yiTE.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=w(e({__name:"form",setup(e){const w=a("新增设备"),C=a(void 0),P=l({assetNo:"",name:"",categoryId:void 0,categoryName:"",model:"",serialNo:"",departmentId:void 0,departmentName:"",responsiblePerson:void 0,responsiblePersonName:"",purchaseDate:void 0,purchasePrice:void 0,warrantyPeriod:void 0,maintenanceCycle:void 0,lastMaintenance:void 0,nextMaintenance:void 0,status:void 0,remark:""}),D=a([]),j=a([]),M=a([]),U=a([]),A=a(-1),O=a(-1),q=a(-1),E=a(-1);t((e=>{K(),R(),S(),$(),e&&e.id?(C.value=Number(e.id),w.value="编辑设备",F(Number(e.id))):w.value="新增设备"}));const F=async e=>{try{const a=await x.getFormData(e);Object.assign(P,a),J()}catch(a){console.error("加载设备数据失败:",a),o({title:"加载数据失败",icon:"none"})}},J=()=>{if(P.categoryId){const e=D.value.findIndex((e=>e.value===P.categoryId));A.value=e}if(P.departmentId){const e=j.value.findIndex((e=>e.value===P.departmentId));O.value=e}if(P.responsiblePerson){const e=M.value.findIndex((e=>e.value===P.responsiblePerson));q.value=e}if(void 0!==P.status){const e=U.value.findIndex((e=>e.value===P.status));E.value=e}},K=async()=>{try{const e=await I.getAllCategoryOptions();D.value=e.map((e=>({value:e.categoryId,text:e.categoryName})))}catch(e){console.error("加载分类选项失败:",e),o({title:"加载分类选项失败",icon:"none"})}},R=async()=>{try{const e=await k.getAllDepartmentOptions();j.value=e.map((e=>({value:e.deptId,text:e.deptName})))}catch(e){console.error("加载部门选项失败:",e),o({title:"加载部门选项失败",icon:"none"})}},S=async()=>{try{const e=await N.getAllEmployeeOptions();M.value=e.map((e=>({value:e.employeeId,text:e.employeeName})))}catch(e){console.error("加载员工选项失败:",e),o({title:"加载员工选项失败",icon:"none"})}},$=async()=>{try{const e=await V.getDictItems("equipment_status");U.value=e.map((e=>({value:Number(e.value),text:e.label})))}catch(e){console.error("加载状态选项失败:",e),o({title:"加载状态选项失败",icon:"none"})}},z=e=>{const a=e.detail.value;A.value=a,D.value[a]&&(P.categoryId=D.value[a].value,P.categoryName=D.value[a].text)},B=e=>{const a=e.detail.value;O.value=a,j.value[a]&&(P.departmentId=j.value[a].value,P.departmentName=j.value[a].text)},G=e=>{const a=e.detail.value;q.value=a,M.value[a]&&(P.responsiblePerson=M.value[a].value,P.responsiblePersonName=M.value[a].text)},H=e=>{const a=e.detail.value;E.value=a,U.value[a]&&(P.status=U.value[a].value)},L=e=>{P.purchaseDate=e.detail.value},Q=e=>{P.lastMaintenance=e.detail.value},T=e=>{P.nextMaintenance=e.detail.value},W=async()=>{if(X())try{g({title:"提交中..."});const e=C.value;e?(await x.update(e,P),o({title:"修改成功",icon:"success"})):(await x.add(P),o({title:"新增成功",icon:"success"})),b()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{h()}},X=()=>P.assetNo?P.name?P.categoryId?P.departmentId?P.responsiblePerson?void 0!==P.status||(o({title:"请选择状态",icon:"none"}),!1):(o({title:"请选择责任人",icon:"none"}),!1):(o({title:"请选择所属部门",icon:"none"}),!1):(o({title:"请选择设备分类",icon:"none"}),!1):(o({title:"请输入设备名称",icon:"none"}),!1):(o({title:"请输入资产编号",icon:"none"}),!1),Y=()=>{b()};return(e,a)=>{const l=d,t=r,o=v,g=p,b=_,h=f,x=y;return u(),s(t,{class:"form-container"},{default:n((()=>[c(t,{class:"form-header"},{default:n((()=>[c(l,{class:"form-title"},{default:n((()=>[i(m(w.value),1)])),_:1})])),_:1}),c(h,{class:"form-body scroll-y","scroll-y":""},{default:n((()=>[c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("资产编号")])),_:1}),c(o,{type:"text",class:"form-input",placeholder:"请输入资产编号",modelValue:P.assetNo,"onUpdate:modelValue":a[0]||(a[0]=e=>P.assetNo=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("设备名称")])),_:1}),c(o,{type:"text",class:"form-input",placeholder:"请输入设备名称",modelValue:P.name,"onUpdate:modelValue":a[1]||(a[1]=e=>P.name=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("设备分类")])),_:1}),c(g,{class:"form-picker",mode:"selector",range:D.value,"range-key":"text",value:A.value,onChange:z},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(A.value>=0?D.value[A.value].text:"请选择设备分类"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("设备型号")])),_:1}),c(o,{type:"text",class:"form-input",placeholder:"请输入设备型号",modelValue:P.model,"onUpdate:modelValue":a[2]||(a[2]=e=>P.model=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("序列号")])),_:1}),c(o,{type:"text",class:"form-input",placeholder:"请输入序列号",modelValue:P.serialNo,"onUpdate:modelValue":a[3]||(a[3]=e=>P.serialNo=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("所属部门")])),_:1}),c(g,{class:"form-picker",mode:"selector",range:j.value,"range-key":"text",value:O.value,onChange:B},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(O.value>=0?j.value[O.value].text:"请选择所属部门"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("责任人")])),_:1}),c(g,{class:"form-picker",mode:"selector",range:M.value,"range-key":"text",value:q.value,onChange:G},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(q.value>=0?M.value[q.value].text:"请选择责任人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("采购日期")])),_:1}),c(g,{class:"form-picker",mode:"date",value:P.purchaseDate,onChange:L},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(P.purchaseDate||"请选择采购日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("采购价格")])),_:1}),c(o,{type:"number",class:"form-input",placeholder:"请输入采购价格",modelValue:P.purchasePrice,"onUpdate:modelValue":a[4]||(a[4]=e=>P.purchasePrice=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("保修期(月)")])),_:1}),c(o,{type:"number",class:"form-input",placeholder:"请输入保修期",modelValue:P.warrantyPeriod,"onUpdate:modelValue":a[5]||(a[5]=e=>P.warrantyPeriod=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("维保周期(月)")])),_:1}),c(o,{type:"number",class:"form-input",placeholder:"请输入维保周期",modelValue:P.maintenanceCycle,"onUpdate:modelValue":a[6]||(a[6]=e=>P.maintenanceCycle=e)},null,8,["modelValue"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("上次维保日期")])),_:1}),c(g,{class:"form-picker",mode:"date",value:P.lastMaintenance,onChange:Q},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(P.lastMaintenance||"请选择上次维保日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("下次维保日期")])),_:1}),c(g,{class:"form-picker",mode:"date",value:P.nextMaintenance,onChange:T},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(P.nextMaintenance||"请选择下次维保日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("状态")])),_:1}),c(g,{class:"form-picker",mode:"selector",range:U.value,"range-key":"text",value:E.value,onChange:H},{default:n((()=>[c(t,{class:"picker-view"},{default:n((()=>[i(m(E.value>=0?U.value[E.value].text:"请选择状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(t,{class:"form-item"},{default:n((()=>[c(l,{class:"form-label"},{default:n((()=>[i("备注")])),_:1}),c(b,{class:"form-textarea",placeholder:"请输入备注",modelValue:P.remark,"onUpdate:modelValue":a[7]||(a[7]=e=>P.remark=e)},null,8,["modelValue"])])),_:1})])),_:1}),c(t,{class:"form-footer"},{default:n((()=>[c(x,{class:"form-btn cancel",onClick:Y},{default:n((()=>[i("取消")])),_:1}),c(x,{class:"form-btn confirm",onClick:W},{default:n((()=>[i("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-102235c0"]]);export{C as default};
