import{d as e,h as a,y as l,al as t,$ as o,l as r,a as s,w as u,i,E as n,G as m,o as c,e as d,s as f,g as p,t as v,ay as y,a4 as _,a6 as g,a5 as b,a0 as N,aI as h,a3 as w,aJ as k}from"./index-5U173LQ3.js";import{_ as j}from"./wd-datetime-picker.BfyXiKcO.js";import{A as V}from"./aioveu-inbound.C8Ihxqct.js";import{A as S}from"./aioveu-material.D870okzX.js";import{A}from"./aioveu-warehouse.DBFoddqK.js";import{A as D}from"./aioveu-employee.BSG7yiTE.js";import{D as I}from"./dict.R0KYYCD_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-picker-view.C4DkyJ3f.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./dayjs.CSix6rHa.js";const T=x(e({__name:"form",setup(e){const x=a("新增入库"),T=a(void 0),$=a(!1),C=a(void 0),U=l({inboundNo:"",materialName:"",warehouseName:"",quantity:void 0,unitPrice:void 0,totalAmount:void 0,batchNumber:"",inboundType:void 0,operatorName:"",remark:""}),M=a([]),P=a([]),O=a([]),q=a([]),F=a(-1),E=a(-1),H=a(-1),J=a(-1);t((e=>{console.log("页面参数:",e),G(),L(),Q(),W(),e.id?(T.value=Number(e.id),x.value="编辑入库",Y()):x.value="新增入库",C.value=T.value}));const Y=async()=>{if(T.value)try{$.value=!0;const e=await V.getFormData(T.value);if(Object.assign(U,e),U.materialName){const e=M.value.findIndex((e=>e.materialName===U.materialName));F.value=e}if(U.warehouseName){const e=P.value.findIndex((e=>e.warehouseName===U.warehouseName));E.value=e}if(U.operatorName){const e=O.value.findIndex((e=>e.employeeName===U.operatorName));H.value=e}if(void 0!==U.inboundType){const e=q.value.findIndex((e=>Number(e.value)===U.inboundType));J.value=e}}catch(e){console.error("加载入库数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{$.value=!1}},G=async()=>{try{const e=await S.getAllMaterialOptions();Array.isArray(e)&&(M.value=e.map((e=>({materialId:Number(e.materialId),materialName:e.materialName}))))}catch(e){console.error("加载物资列表失败:",e),o({title:"加载物资列表失败",icon:"none"})}},L=async()=>{try{const e=await A.getAllWarehouseOptions();Array.isArray(e)&&(P.value=e.map((e=>({warehouseId:Number(e.warehouseId),warehouseName:e.warehouseName}))))}catch(e){console.error("加载仓库列表失败:",e),o({title:"加载仓库列表失败",icon:"none"})}},Q=async()=>{try{const e=await D.getAllEmployeeOptions();Array.isArray(e)&&(O.value=e.map((e=>({employeeId:Number(e.employeeId),employeeName:e.employeeName}))))}catch(e){console.error("加载员工列表失败:",e),o({title:"加载员工列表失败",icon:"none"})}},W=async()=>{try{const e=await I.getDictItems("inbound_type");q.value=e}catch(e){console.error("加载入库类型失败:",e),o({title:"加载入库类型失败",icon:"none"})}},z=e=>{const a=e.detail.value;F.value=a,M.value[a]&&(U.materialName=M.value[a].materialName)},B=e=>{const a=e.detail.value;E.value=a,P.value[a]&&(U.warehouseName=P.value[a].warehouseName)},K=e=>{const a=e.detail.value;H.value=a,O.value[a]&&(U.operatorName=O.value[a].employeeName)},R=e=>{const a=e.detail.value;J.value=a,q.value[a]&&(U.inboundType=Number(q.value[a].value))},X=e=>{U.productionDate=e.detail.value},Z=e=>{console.log(e.detail.value),U.expiryDate=e.detail.value},ee=e=>{console.log(e.value),console.log("最后出库时间选择事件对象:",e.value),U.inTime=new Date(e.value)},ae=r((()=>{const e=(a=U.inTime)?`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`:"";var a;console.log("原始 inTime (Date):",U.inTime),console.log("转换后的 inTime (string):",e);const l={...U,inTime:e};return console.log("backendFormData 对象:",JSON.stringify(l,null,2)),l})),le=async()=>{if(te())try{h({title:"提交中..."});const e=C.value,a=ae.value;e?(await V.update(e,a),o({title:"修改成功",icon:"success"})):(await V.add(a),o({title:"新增成功",icon:"success"})),w()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{k()}},te=()=>U.inboundNo?U.materialName?U.warehouseName?U.quantity?U.unitPrice?U.totalAmount?U.inTime?!!U.operatorName||(o({title:"请选择操作员",icon:"none"}),!1):(o({title:"请选择入库时间",icon:"none"}),!1):(o({title:"请输入总金额",icon:"none"}),!1):(o({title:"请输入入库单价",icon:"none"}),!1):(o({title:"请输入入库数量",icon:"none"}),!1):(o({title:"请选择仓库",icon:"none"}),!1):(o({title:"请选择物资",icon:"none"}),!1):(o({title:"请输入入库单号",icon:"none"}),!1),oe=()=>{w()};return(e,a)=>{const l=f,t=i,o=_,r=g,h=n(m("wd-datetime-picker"),j),w=b,k=y,V=N;return c(),s(t,{class:"form-container"},{default:u((()=>[d(t,{class:"form-header"},{default:u((()=>[d(l,{class:"form-title"},{default:u((()=>[p(v(x.value),1)])),_:1})])),_:1}),d(k,{class:"form-body scroll-y","scroll-y":""},{default:u((()=>[d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("入库单号")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入入库单号",modelValue:U.inboundNo,"onUpdate:modelValue":a[0]||(a[0]=e=>U.inboundNo=e)},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("物资")])),_:1}),d(r,{class:"form-picker",mode:"selector",range:M.value,"range-key":"materialName",value:F.value,onChange:z},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>[p(v(F.value>=0?M.value[F.value].materialName:"请选择物资"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("仓库")])),_:1}),d(r,{class:"form-picker",mode:"selector",range:P.value,"range-key":"warehouseName",value:E.value,onChange:B},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>[p(v(E.value>=0?P.value[E.value].warehouseName:"请选择仓库"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("入库数量")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入入库数量",modelValue:U.quantity,"onUpdate:modelValue":a[1]||(a[1]=e=>U.quantity=e)},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("入库单价")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入入库单价",modelValue:U.unitPrice,"onUpdate:modelValue":a[2]||(a[2]=e=>U.unitPrice=e)},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("总金额")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入总金额",modelValue:U.totalAmount,"onUpdate:modelValue":a[3]||(a[3]=e=>U.totalAmount=e)},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("批次号")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入批次号",modelValue:U.batchNumber,"onUpdate:modelValue":a[4]||(a[4]=e=>U.batchNumber=e)},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("生产日期")])),_:1}),d(r,{class:"form-picker",mode:"date",value:U.productionDate,onChange:X},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>[p(v(U.productionDate||"请选择生产日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("有效期至")])),_:1}),d(r,{class:"form-picker",mode:"date",value:U.expiryDate,onChange:Z},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>[p(v(U.expiryDate||"请选择有效期至"),1)])),_:1})])),_:1},8,["value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("供应商ID")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入供应商ID",modelValue:U.supplierId,"onUpdate:modelValue":a[5]||(a[5]=e=>U.supplierId=e)},null,8,["modelValue"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("入库类型")])),_:1}),d(r,{class:"form-picker",mode:"selector",range:q.value,"range-key":"label",value:J.value,onChange:R},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>[p(v(J.value>=0?q.value[J.value].label:"请选择入库类型"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("入库时间")])),_:1}),d(h,{class:"form-picker",mode:"datetime",value:U.inTime,"default-value":new Date,onConfirm:ee},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>{return[p(v(U.inTime?(e=U.inTime,`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`):"请选择入库时间"),1)];var e})),_:1})])),_:1},8,["value","default-value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("操作员")])),_:1}),d(r,{class:"form-picker",mode:"selector",range:O.value,"range-key":"employeeName",value:H.value,onChange:K},{default:u((()=>[d(t,{class:"picker-view"},{default:u((()=>[p(v(H.value>=0?O.value[H.value].employeeName:"请选择操作员"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(t,{class:"form-item"},{default:u((()=>[d(l,{class:"form-label"},{default:u((()=>[p("备注")])),_:1}),d(w,{class:"form-textarea",placeholder:"请输入备注",modelValue:U.remark,"onUpdate:modelValue":a[6]||(a[6]=e=>U.remark=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(t,{class:"form-footer"},{default:u((()=>[d(V,{class:"form-btn cancel",onClick:oe},{default:u((()=>[p("取消")])),_:1}),d(V,{class:"form-btn confirm",onClick:le},{default:u((()=>[p("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-e70ae3f0"]]);export{T as default};
