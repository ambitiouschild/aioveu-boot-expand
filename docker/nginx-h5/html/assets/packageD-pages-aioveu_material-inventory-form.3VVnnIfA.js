import{d as a,h as e,y as t,al as l,$ as o,l as s,a as r,w as u,i as n,E as i,G as d,o as m,e as c,s as f,g as p,t as v,ay as b,a6 as w,a4 as _,a0 as g,aI as y,a3 as h,aJ as N}from"./index-5U173LQ3.js";import{_ as S}from"./wd-datetime-picker.BfyXiKcO.js";import{A as j}from"./aioveu-inventory.D9zDSFh5.js";import{A as k}from"./aioveu-warehouse.DBFoddqK.js";import{A as D}from"./aioveu-material.D870okzX.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-picker-view.C4DkyJ3f.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./dayjs.CSix6rHa.js";const O=I(a({__name:"form",setup(a){const I=e("新增库存"),O=e(void 0),$=e(!1),x=t({warehouseName:"",materialName:"",quantity:void 0,batchNumber:""}),A=e([]),C=e([]),M=e(-1),V=e(-1),q=a=>{if(!a)return"";return`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`},F=a=>`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`;l((a=>{console.log("页面参数:",a),P(),U(),a.id?(O.value=Number(a.id),I.value="编辑库存",H()):(I.value="新增库存",x.lastInbound=new Date,x.lastOutbound=new Date)}));const H=async()=>{if(O.value)try{$.value=!0;const a=await j.getFormData(O.value);if(Object.assign(x,{data:a,lastInbound:a.lastInbound?new Date(a.lastInbound):new Date,lastOutbound:a.lastOutbound?new Date(a.lastOutbound):new Date}),x.warehouseName){const a=A.value.findIndex((a=>a.warehouseName===x.warehouseName));M.value=a}if(x.materialName){const a=C.value.findIndex((a=>a.materialName===x.materialName));V.value=a}}catch(a){console.error("加载库存数据失败:",a),o({title:"加载数据失败",icon:"none"})}finally{$.value=!1}},P=async()=>{try{const a=await k.getAllWarehouseOptions();Array.isArray(a)&&(A.value=a.map((a=>({warehouseId:Number(a.warehouseId),warehouseName:a.warehouseName}))))}catch(a){console.error("加载仓库列表失败:",a),o({title:"加载仓库列表失败",icon:"none"})}},U=async()=>{try{const a=await D.getAllMaterialOptions();Array.isArray(a)&&(C.value=a.map((a=>({materialId:Number(a.materialId),materialName:a.materialName}))))}catch(a){console.error("加载物资列表失败:",a),o({title:"加载物资列表失败",icon:"none"})}},Y=a=>{const e=a.detail.value;M.value=e,A.value[e]&&(x.warehouseName=A.value[e].warehouseName)},E=a=>{const e=a.detail.value;V.value=e,C.value[e]&&(x.materialName=C.value[e].materialName)},G=a=>{x.productionDate=a.detail.value},J=a=>{x.expiryDate=a.detail.value},L=a=>{console.log("最后入库时间选择事件对象:",a),x.lastInbound=new Date(a.value)},T=a=>{console.log("最后出库时间选择事件对象:",a),x.lastOutbound=new Date(a.value)},W=s((()=>({...x,lastInbound:q(x.lastInbound),lastOutbound:q(x.lastOutbound)}))),z=async()=>{if(B())try{y({title:"提交中..."});const a=W.value;O.value?(await j.update(O.value,a),o({title:"修改成功",icon:"success"})):(await j.add(a),o({title:"新增成功",icon:"success"})),h()}catch(a){console.error("提交表单失败:",a),o({title:"提交失败",icon:"none"})}finally{N()}},B=()=>x.warehouseName?x.materialName?!!x.quantity||(o({title:"请输入库存数量",icon:"none"}),!1):(o({title:"请选择物资",icon:"none"}),!1):(o({title:"请选择仓库",icon:"none"}),!1),K=()=>{h()};return(a,e)=>{const t=f,l=n,o=w,s=_,y=i(d("wd-datetime-picker"),S),h=b,N=g;return m(),r(l,{class:"form-container"},{default:u((()=>[c(l,{class:"form-header"},{default:u((()=>[c(t,{class:"form-title"},{default:u((()=>[p(v(I.value),1)])),_:1})])),_:1}),c(h,{class:"form-body scroll-y","scroll-y":""},{default:u((()=>[c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("仓库")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:A.value,"range-key":"warehouseName",value:M.value,onChange:Y},{default:u((()=>[c(l,{class:"picker-view"},{default:u((()=>[p(v(M.value>=0?A.value[M.value].warehouseName:"请选择仓库"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("物资")])),_:1}),c(o,{class:"form-picker",mode:"selector",range:C.value,"range-key":"materialName",value:V.value,onChange:E},{default:u((()=>[c(l,{class:"picker-view"},{default:u((()=>[p(v(V.value>=0?C.value[V.value].materialName:"请选择物资"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("当前库存量")])),_:1}),c(s,{type:"number",class:"form-input",placeholder:"请输入当前库存量",modelValue:x.quantity,"onUpdate:modelValue":e[0]||(e[0]=a=>x.quantity=a)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("批次号")])),_:1}),c(s,{type:"text",class:"form-input",placeholder:"请输入批次号",modelValue:x.batchNumber,"onUpdate:modelValue":e[1]||(e[1]=a=>x.batchNumber=a)},null,8,["modelValue"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("生产日期")])),_:1}),c(o,{class:"form-picker",mode:"date",value:x.productionDate,onChange:G},{default:u((()=>[c(l,{class:"picker-view"},{default:u((()=>[p(v(x.productionDate||"请选择生产日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("有效期至")])),_:1}),c(o,{class:"form-picker",mode:"date",value:x.expiryDate,onChange:J},{default:u((()=>[c(l,{class:"picker-view"},{default:u((()=>[p(v(x.expiryDate||"请选择有效期至"),1)])),_:1})])),_:1},8,["value"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("最后入库时间")])),_:1}),c(y,{class:"form-picker",mode:"datetime",value:x.lastInbound,"default-value":new Date,onConfirm:L},{default:u((()=>[c(l,{class:"picker-view"},{default:u((()=>[p(v(x.lastInbound?F(x.lastInbound):"请选择最后入库时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(t,{class:"form-label"},{default:u((()=>[p("最后出库时间")])),_:1}),c(y,{class:"form-picker",mode:"datetime",value:x.lastOutbound,"default-value":new Date,onConfirm:T},{default:u((()=>[c(l,{class:"picker-view"},{default:u((()=>[p(v(x.lastOutbound?F(x.lastOutbound):"请选择最后出库时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1})])),_:1}),c(l,{class:"form-footer"},{default:u((()=>[c(N,{class:"form-btn cancel",onClick:K},{default:u((()=>[p("取消")])),_:1}),c(N,{class:"form-btn confirm",onClick:z},{default:u((()=>[p("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-4004ddd7"]]);export{O as default};
