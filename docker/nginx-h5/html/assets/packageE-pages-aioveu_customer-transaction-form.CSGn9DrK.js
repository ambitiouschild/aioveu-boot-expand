import{d as e,h as a,y as t,al as l,$ as o,l as s,a as u,w as n,i as r,E as c,G as m,o as i,e as d,s as f,g as v,t as p,ay as _,a4 as y,a6 as g,a5 as b,a0 as N,aI as V,a3 as h,aJ as w}from"./index-5U173LQ3.js";import{_ as k}from"./wd-datetime-picker.BfyXiKcO.js";import{A as S}from"./aioveu-transaction.BId28B5W.js";import{A as D}from"./aioveu-customer.MhylDKEJ.js";import{A as j}from"./aioveu-contact.B_5Ds4O-.js";import{A as I}from"./aioveu-employee.t1i7jtWp.js";import{D as x}from"./dict.R0KYYCD_.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-picker-view.C4DkyJ3f.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./dayjs.CSix6rHa.js";const C=A(e({__name:"form",setup(e){const A=a("新增交易记录"),C=a(void 0),$=a(!1),U=a(void 0),M=t({}),R=a([]),T=a([]),O=a([]),P=a([]),F=a([]),Y=a([]),q=a([]),E=a(-1),H=a(-1),G=a(-1),J=a(-1),W=a(-1),X=a(-1),z=a(-1);l((e=>{console.log("页面参数:",e),L(),Q(),Z(),ee(),e.id?(C.value=Number(e.id),A.value="编辑交易记录",K()):A.value="新增交易记录",U.value=C.value}));const B=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},K=async()=>{if(C.value)try{$.value=!0;const e=await S.getFormData(C.value);if(Object.assign(M,{...e,transactionDate:e.transactionDate?new Date(e.transactionDate):new Date}),M.customerName){const e=R.value.findIndex((e=>e.customerName===M.customerName));E.value=e}if(M.contactName){const e=T.value.findIndex((e=>e.contactName===M.contactName));H.value=e}if(M.salesRepName){const e=O.value.findIndex((e=>e.employeeName===M.salesRepName));G.value=e}if(void 0!==M.paymentMethod){const e=P.value.findIndex((e=>Number(e.value)===M.paymentMethod));J.value=e}if(void 0!==M.paymentStatus){const e=F.value.findIndex((e=>Number(e.value)===M.paymentStatus));W.value=e}if(void 0!==M.transactionType){const e=Y.value.findIndex((e=>Number(e.value)===M.transactionType));X.value=e}if(void 0!==M.transactionStatus){const e=q.value.findIndex((e=>Number(e.value)===M.transactionStatus));z.value=e}}catch(e){console.error("加载交易记录数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{$.value=!1}},L=async()=>{try{const e=await D.getAllCustomerOptions();Array.isArray(e)&&(R.value=e.map((e=>({customerId:Number(e.customerId),customerName:e.customerName}))))}catch(e){console.error("加载客户列表失败:",e),o({title:"加载客户列表失败",icon:"none"})}},Q=async()=>{try{const e=await j.getAllContactOptions();Array.isArray(e)&&(T.value=e.map((e=>({contactId:Number(e.contactId),contactName:e.contactName}))))}catch(e){console.error("加载联系人列表失败:",e),o({title:"加载联系人列表失败",icon:"none"})}},Z=async()=>{try{const e=await I.getAllEmployeeOptions();Array.isArray(e)&&(O.value=e.map((e=>({employeeId:Number(e.employeeId),employeeName:e.employeeName}))))}catch(e){console.error("加载员工列表失败:",e),o({title:"加载员工列表失败",icon:"none"})}},ee=async()=>{try{const e=await x.getDictItems("transaction_payment_method");P.value=e;const a=await x.getDictItems("transaction_payment_status");F.value=a;const t=await x.getDictItems("transaction_type");Y.value=t;const l=await x.getDictItems("transaction_status");q.value=l}catch(e){console.error("加载字典选项失败:",e),o({title:"加载选项失败",icon:"none"})}},ae=e=>{const a=e.detail.value;E.value=a,R.value[a]&&(M.customerName=R.value[a].customerName)},te=e=>{const a=e.detail.value;H.value=a,T.value[a]&&(M.contactName=T.value[a].contactName)},le=e=>{const a=e.detail.value;J.value=a,P.value[a]&&(M.paymentMethod=Number(P.value[a].value))},oe=e=>{const a=e.detail.value;W.value=a,F.value[a]&&(M.paymentStatus=Number(F.value[a].value))},se=e=>{const a=e.detail.value;X.value=a,Y.value[a]&&(M.transactionType=Number(Y.value[a].value))},ue=e=>{const a=e.detail.value;z.value=a,q.value[a]&&(M.transactionStatus=Number(q.value[a].value))},ne=e=>{const a=e.detail.value;G.value=a,O.value[a]&&(M.salesRepName=O.value[a].employeeName)},re=e=>{M.transactionDate=new Date(e.value)},ce=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},me=s((()=>({...M,transactionDate:ce(M.transactionDate)}))),ie=async()=>{if(de())try{V({title:"提交中..."});const e=U.value,a=me.value;e?(await S.update(e,a),o({title:"修改成功",icon:"success"})):(await S.add(a),o({title:"新增成功",icon:"success"})),h()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{w()}},de=()=>M.transactionNo?M.customerName?M.contactName?M.transactionDate?void 0===M.amount?(o({title:"请输入交易金额",icon:"none"}),!1):void 0===M.paymentMethod?(o({title:"请选择支付方式",icon:"none"}),!1):void 0===M.paymentStatus?(o({title:"请选择支付状态",icon:"none"}),!1):void 0===M.transactionType?(o({title:"请选择交易类型",icon:"none"}),!1):void 0!==M.transactionStatus||(o({title:"请选择交易状态",icon:"none"}),!1):(o({title:"请选择交易日期",icon:"none"}),!1):(o({title:"请选择联系人",icon:"none"}),!1):(o({title:"请选择客户",icon:"none"}),!1):(o({title:"请输入交易编号",icon:"none"}),!1),fe=()=>{h()};return(e,a)=>{const t=f,l=r,o=y,s=g,V=c(m("wd-datetime-picker"),k),h=b,w=_,S=N;return i(),u(l,{class:"form-container"},{default:n((()=>[d(l,{class:"form-header"},{default:n((()=>[d(t,{class:"form-title"},{default:n((()=>[v(p(A.value),1)])),_:1})])),_:1}),d(w,{class:"form-body scroll-y","scroll-y":""},{default:n((()=>[d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("交易编号")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入交易编号",modelValue:M.transactionNo,"onUpdate:modelValue":a[0]||(a[0]=e=>M.transactionNo=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("客户")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:R.value,"range-key":"customerName",value:E.value,onChange:ae},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(E.value>=0?R.value[E.value].customerName:"请选择客户"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("联系人")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:T.value,"range-key":"contactName",value:H.value,onChange:te},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(H.value>=0?T.value[H.value].contactName:"请选择联系人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("交易日期")])),_:1}),d(V,{class:"form-picker",mode:"date",value:M.transactionDate,"default-value":new Date,onConfirm:re},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(M.transactionDate?B(M.transactionDate):"请选择交易日期"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("交易金额")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入交易金额",modelValue:M.amount,"onUpdate:modelValue":a[1]||(a[1]=e=>M.amount=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("货币代码")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入货币代码",modelValue:M.currency,"onUpdate:modelValue":a[2]||(a[2]=e=>M.currency=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("支付方式")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:P.value,"range-key":"label",value:J.value,onChange:le},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(J.value>=0?P.value[J.value].label:"请选择支付方式"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("支付状态")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:F.value,"range-key":"label",value:W.value,onChange:oe},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(W.value>=0?F.value[W.value].label:"请选择支付状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("交易类型")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:Y.value,"range-key":"label",value:X.value,onChange:se},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(X.value>=0?Y.value[X.value].label:"请选择交易类型"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("发票号码")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入发票号码",modelValue:M.invoiceNo,"onUpdate:modelValue":a[3]||(a[3]=e=>M.invoiceNo=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("产品ID")])),_:1}),d(o,{type:"text",class:"form-input",placeholder:"请输入产品ID",modelValue:M.productId,"onUpdate:modelValue":a[4]||(a[4]=e=>M.productId=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("数量")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入数量",modelValue:M.quantity,"onUpdate:modelValue":a[5]||(a[5]=e=>M.quantity=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("单价")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入单价",modelValue:M.unitPrice,"onUpdate:modelValue":a[6]||(a[6]=e=>M.unitPrice=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("折扣率")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入折扣率",modelValue:M.discount,"onUpdate:modelValue":a[7]||(a[7]=e=>M.discount=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("税率")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入税率",modelValue:M.taxRate,"onUpdate:modelValue":a[8]||(a[8]=e=>M.taxRate=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("税额")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入税额",modelValue:M.taxAmount,"onUpdate:modelValue":a[9]||(a[9]=e=>M.taxAmount=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("总金额")])),_:1}),d(o,{type:"number",class:"form-input",placeholder:"请输入总金额",modelValue:M.totalAmount,"onUpdate:modelValue":a[10]||(a[10]=e=>M.totalAmount=e)},null,8,["modelValue"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("负责人")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:O.value,"range-key":"employeeName",value:G.value,onChange:ne},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(G.value>=0?O.value[G.value].employeeName:"请选择负责人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("交易状态")])),_:1}),d(s,{class:"form-picker",mode:"selector",range:q.value,"range-key":"label",value:z.value,onChange:ue},{default:n((()=>[d(l,{class:"picker-view"},{default:n((()=>[v(p(z.value>=0?q.value[z.value].label:"请选择交易状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),d(l,{class:"form-item"},{default:n((()=>[d(t,{class:"form-label"},{default:n((()=>[v("备注")])),_:1}),d(h,{class:"form-textarea",placeholder:"请输入备注",modelValue:M.notes,"onUpdate:modelValue":a[11]||(a[11]=e=>M.notes=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(l,{class:"form-footer"},{default:n((()=>[d(S,{class:"form-btn cancel",onClick:fe},{default:n((()=>[v("取消")])),_:1}),d(S,{class:"form-btn confirm",onClick:ie},{default:n((()=>[v("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-24cd8961"]]);export{C as default};
