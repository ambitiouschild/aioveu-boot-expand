import{d as e,h as t,ax as l,al as a,a as s,w as i,i as u,E as o,G as r,o as n,e as c,u as d,g as m,c as p,F as f,r as v,t as _,aB as x,aa as w,$ as g,X as j}from"./index-5U173LQ3.js";import{_ as b}from"./wd-input.C2gvQ-R0.js";import{_ as y}from"./wd-button.BzRx3gca.js";import{_ as h,a as k,b as z}from"./wd-loadmore.Dd59NB56.js";import{_ as N}from"./wd-tag.CuuEfSYT.js";import{_ as C}from"./wd-cell.yQBIY-AL.js";import{N as S,_ as T}from"./notice.Buo_1jce.js";import{_ as I}from"./wd-cell-group.CJNVuq-S.js";import{_ as V}from"./wd-text.BpXk7M2k.js";import{_ as $}from"./wd-card.qIX23JsB.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./base64.3RFQOR3W.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./wd-transition.7-0aPBrJ.js";import"./clickoutside.C7ctyI5d.js";import"./useChildren.Crbe03ZE.js";import"./wd-divider.DIyXdxGw.js";import"./dict.R0KYYCD_.js";import"./dayjs.CSix6rHa.js";const P=B(e({__name:"index",setup(e){const B=t("finished"),P=t([]),D=t(0),E=t({pageNum:1,pageSize:10,title:""}),F=t(),G=()=>{var e;E.value={pageNum:1,pageSize:10},null==(e=F.value)||e.close(),X()},L=e=>{if(!e)return"default";return{0:"primary",1:"success",[-1]:"warning"}[e]||"default"},M=e=>{if(0!==e&&!e)return"-";return{0:"未发布",1:"已发布",[-1]:"已撤回"}[e]||"未知"},U=e=>e?e.toString():"-",X=async()=>{if("loading"===B.value)return;B.value="loading";const{list:e,total:t}=await S.getPage(E.value);1===E.value.pageNum?P.value=e:P.value=[...P.value,...e],D.value=t,E.value.pageNum++,B.value=P.value.length>=D.value?"finished":"loading"},q=e=>{const t=1!==e.publishStatus?["查看","删除","发布"]:["查看","撤回"];x({itemList:t,success:({tapIndex:l})=>{switch(t[l]){case"查看":(e=>{j({url:`/pages/work/notice/detail?id=${e.id}`})})(e);break;case"删除":A(e);break;case"发布":H(e);break;case"撤回":J(e)}}})},A=e=>{w({title:"提示",content:"确定要删除该通知吗？",success:async t=>{if(t.confirm)try{await S.deleteByIds(e.id),g({title:"删除成功",icon:"success"}),E.value.pageNum=1,X()}catch(l){g({title:"删除失败"+l,icon:"none"})}}})},H=e=>{w({title:"提示",content:"确定要发布该通知吗？",success:async t=>{if(t.confirm)try{await S.publish(Number(e.id)),g({title:"发布成功",icon:"success"}),E.value.pageNum=1,X()}catch(l){g({title:"发布失败"+l,icon:"none"})}}})},J=e=>{w({title:"提示",content:"确定要撤回该通知吗？",success:async t=>{if(t.confirm)try{await S.revoke(Number(e.id)),g({title:"撤回成功",icon:"success"}),E.value.pageNum=1,X()}catch(l){g({title:"撤回失败"+l,icon:"error"})}}})};return l((()=>{"loading"!==B.value&&"finished"!==B.value&&X()})),a((()=>{X()})),(e,t)=>{const l=o(r("wd-input"),b),a=o(r("wd-button"),y),x=u,w=o(r("wd-drop-menu-item"),h),g=o(r("wd-drop-menu"),k),j=o(r("wd-tag"),N),S=o(r("wd-cell"),C),D=o(r("cu-dict-label"),T),A=o(r("wd-cell-group"),I),H=o(r("wd-text"),V),J=o(r("wd-card"),$),K=o(r("wd-loadmore"),z);return n(),s(x,null,{default:i((()=>[c(g,{"close-on-click-modal":"",class:"mb-20rpx mr-20rpx ml-20rpx close-on-click-modal"},{default:i((()=>[c(w,{ref_key:"dropMenu",ref:F,title:"筛选",icon:"filter","icon-size":"18px"},{default:i((()=>[c(x,null,{default:i((()=>[c(l,{modelValue:d(E).title,"onUpdate:modelValue":t[0]||(t[0]=e=>d(E).title=e),label:"关键字",type:"text",placeholder:"请输入关键字"},null,8,["modelValue"]),c(x,{class:"flex flex-row items-center mb-20rpx"},{default:i((()=>[c(a,{class:"mt-20rpx mb-20rpx",size:"medium",onClick:t[1]||(t[1]=e=>{return E.value.pageNum=1,X(),void(null==(t=F.value)||t.close());var t})},{default:i((()=>[m(" 查询 ")])),_:1}),c(a,{size:"medium",type:"info",onClick:G},{default:i((()=>[m("重置")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1}),c(x,{class:"data-container"},{default:i((()=>[(n(!0),p(f,null,v(d(P),((e,t)=>(n(),s(x,{key:t,class:"mt-20rpx"},{default:i((()=>[c(J,null,{title:i((()=>[c(x,{class:"flex items-center justify-between"},{default:i((()=>[c(x,{class:"flex-1 text-truncate"},{default:i((()=>[m(_(e.title),1)])),_:2},1024),c(j,{type:L(e.publishStatus),size:"small"},{default:i((()=>[m(_(M(e.publishStatus)),1)])),_:2},1032,["type"])])),_:2},1024)])),footer:i((()=>[c(x,{class:"flex-between"},{default:i((()=>[1===e.publishStatus?(n(),s(x,{key:0,class:"text-left"},{default:i((()=>[c(H,{text:"发布时间：",size:"small",class:"font-bold text-发布时间："}),c(H,{text:U(e.publishTime),size:"small"},null,8,["text"])])),_:2},1024)):(n(),s(x,{key:1,class:"text-left"},{default:i((()=>[c(H,{text:"撤回时间：",size:"small",class:"font-bold text-撤回时间："}),c(H,{text:U(e.revokeTime),size:"small"},null,8,["text"])])),_:2},1024)),c(x,{class:"text-right"},{default:i((()=>[c(a,{size:"small",plain:"",type:"primary",onClick:t=>q(e),class:"plain"},{default:i((()=>[m(" 操作 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),default:i((()=>[c(A,null,{default:i((()=>[c(S,{title:"通告目标类型",value:1===e.targetType?"指定":"全体"},null,8,["value"]),c(S,{title:"紧急程度"},{default:i((()=>[c(D,{code:"notice_level","model-value":e.level},null,8,["model-value"])])),_:2},1024),c(S,{title:"发布人",value:e.publisherName||"-"},null,8,["value"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),c(K,{"custom-class":"loadmore",state:d(B)},null,8,["state"])])),_:1})}}}),[["__scopeId","data-v-a180d185"]]);export{P as default};
