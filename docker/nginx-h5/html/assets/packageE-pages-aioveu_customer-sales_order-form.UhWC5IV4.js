import{d as e,h as a,y as l,al as t,$ as o,l as s,a as r,w as u,i as m,E as n,G as c,o as d,e as i,s as f,g as v,t as p,ay as _,a4 as g,a6 as y,a5 as N,a0 as b,aI as h,a3 as k,aJ as w}from"./index-5U173LQ3.js";import{_ as V}from"./wd-datetime-picker.BfyXiKcO.js";import{A as D}from"./aioveu-sales-order.NYwjDYB-.js";import{A as S}from"./aioveu-customer.MhylDKEJ.js";import{A as x}from"./aioveu-contact.B_5Ds4O-.js";import{A as j}from"./aioveu-employee.t1i7jtWp.js";import{D as A}from"./dict.R0KYYCD_.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CDbxLjoy.js";import"./wd-popup.BsbILK4T.js";import"./wd-overlay.iGBdgU4M.js";import"./base64.3RFQOR3W.js";import"./wd-transition.7-0aPBrJ.js";import"./wd-picker-view.C4DkyJ3f.js";import"./useCell.qN6vSEvF.js";import"./useParent.Bak0uCS8.js";import"./types.DZx-jF8C.js";import"./types.Prh_CF5p.js";import"./useTranslate.Kg86_MV8.js";import"./index.BkHvPazf.js";import"./dayjs.CSix6rHa.js";const C=I(e({__name:"form",setup(e){const I=a("新增销售订单"),C=a(void 0),$=a(!1),U=a(void 0),O=l({}),M=a([]),T=a([]),R=a([]),F=a([]),E=a([]),H=a([]),P=a([]),Y=a(-1),G=a(-1),J=a(-1),W=a(-1),X=a(-1),Z=a(-1),q=a(-1),z=a(-1),B=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`};t((e=>{console.log("页面参数:",e),U.value=C.value,L(),Q(),ee(),ae(),e.id?(C.value=Number(e.id),I.value="编辑销售订单",K()):I.value="新增销售订单"}));const K=async()=>{if(C.value)try{$.value=!0;const e=await D.getFormData(C.value);if(Object.assign(O,{...e,orderDate:e.orderDate?new Date(e.orderDate):new Date}),O.customerName){const e=M.value.findIndex((e=>e.customerName===O.customerName));Y.value=e}if(O.contactName){const e=T.value.findIndex((e=>e.contactName===O.contactName));G.value=e}if(O.salesRepName){const e=R.value.findIndex((e=>e.employeeName===O.salesRepName));J.value=e}if(O.operatorName){const e=R.value.findIndex((e=>e.employeeName===O.operatorName));W.value=e}if(void 0!==O.paymentTerms){const e=F.value.findIndex((e=>Number(e.value)===O.paymentTerms));X.value=e}if(void 0!==O.paymentStatus){const e=E.value.findIndex((e=>Number(e.value)===O.paymentStatus));Z.value=e}if(void 0!==O.orderStatus){const e=H.value.findIndex((e=>Number(e.value)===O.orderStatus));q.value=e}if(void 0!==O.shippingMethod){const e=P.value.findIndex((e=>Number(e.value)===O.shippingMethod));z.value=e}}catch(e){console.error("加载销售订单数据失败:",e),o({title:"加载数据失败",icon:"none"})}finally{$.value=!1}},L=async()=>{try{const e=await S.getAllCustomerOptions();Array.isArray(e)&&(M.value=e.map((e=>({customerId:Number(e.customerId),customerName:e.customerName}))))}catch(e){console.error("加载客户列表失败:",e),o({title:"加载客户列表失败",icon:"none"})}},Q=async()=>{try{const e=await x.getAllContactOptions();Array.isArray(e)&&(T.value=e.map((e=>({contactId:Number(e.contactId),contactName:e.contactName}))))}catch(e){console.error("加载联系人列表失败:",e),o({title:"加载联系人列表失败",icon:"none"})}},ee=async()=>{try{const e=await j.getAllEmployeeOptions();Array.isArray(e)&&(R.value=e.map((e=>({employeeId:Number(e.employeeId),employeeName:e.employeeName}))))}catch(e){console.error("加载员工列表失败:",e),o({title:"加载员工列表失败",icon:"none"})}},ae=async()=>{try{const e=await A.getDictItems("salesOrder_payment_terms");F.value=e;const a=await A.getDictItems("salesOrder_payment_status");E.value=a;const l=await A.getDictItems("salesOrder_order_status");H.value=l;const t=await A.getDictItems("salesOrder_shipping_method");P.value=t}catch(e){console.error("加载字典选项失败:",e),o({title:"加载选项失败",icon:"none"})}},le=e=>{const a=e.detail.value;Y.value=a,M.value[a]&&(O.customerName=M.value[a].customerName)},te=e=>{const a=e.detail.value;G.value=a,T.value[a]&&(O.contactName=T.value[a].contactName)},oe=e=>{O.orderDate=new Date(e.value)},se=e=>{O.expectedDelivery=e.detail.value},re=e=>{O.actualDelivery=e.detail.value},ue=e=>{const a=e.detail.value;X.value=a,F.value[a]&&(O.paymentTerms=Number(F.value[a].value))},me=e=>{const a=e.detail.value;Z.value=a,E.value[a]&&(O.paymentStatus=Number(E.value[a].value))},ne=e=>{const a=e.detail.value;q.value=a,H.value[a]&&(O.orderStatus=Number(H.value[a].value))},ce=e=>{const a=e.detail.value;z.value=a,P.value[a]&&(O.shippingMethod=Number(P.value[a].value))},de=e=>{const a=e.detail.value;J.value=a,R.value[a]&&(O.salesRepName=R.value[a].employeeName)},ie=e=>{const a=e.detail.value;W.value=a,R.value[a]&&(O.operatorName=R.value[a].employeeName)},fe=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`},ve=s((()=>({...O,orderDate:fe(O.orderDate)}))),pe=async()=>{if(_e())try{h({title:"提交中..."});const e=ve.value,a=U.value;a?(await D.update(a,e),o({title:"修改成功",icon:"success"})):(await D.add(e),o({title:"新增成功",icon:"success"})),k()}catch(e){console.error("提交表单失败:",e),o({title:"提交失败",icon:"none"})}finally{w()}},_e=()=>O.orderNo?O.customerName?O.contactName?O.orderDate?void 0===O.totalAmount?(o({title:"请输入订单总金额",icon:"none"}),!1):void 0===O.paymentStatus?(o({title:"请选择支付状态",icon:"none"}),!1):void 0!==O.orderStatus||(o({title:"请选择订单状态",icon:"none"}),!1):(o({title:"请选择下单时间",icon:"none"}),!1):(o({title:"请选择联系人",icon:"none"}),!1):(o({title:"请选择客户",icon:"none"}),!1):(o({title:"请输入订单编号",icon:"none"}),!1),ge=()=>{k()};return(e,a)=>{const l=f,t=m,o=g,s=y,h=n(c("wd-datetime-picker"),V),k=N,w=_,D=b;return d(),r(t,{class:"form-container"},{default:u((()=>[i(t,{class:"form-header"},{default:u((()=>[i(l,{class:"form-title"},{default:u((()=>[v(p(I.value),1)])),_:1})])),_:1}),i(w,{class:"form-body scroll-y","scroll-y":""},{default:u((()=>[i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("订单编号")])),_:1}),i(o,{type:"text",class:"form-input",placeholder:"请输入订单编号",modelValue:O.orderNo,"onUpdate:modelValue":a[0]||(a[0]=e=>O.orderNo=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("客户")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:M.value,"range-key":"customerName",value:Y.value,onChange:le},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(Y.value>=0?M.value[Y.value].customerName:"请选择客户"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("联系人")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:T.value,"range-key":"contactName",value:G.value,onChange:te},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(G.value>=0?T.value[G.value].contactName:"请选择联系人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("下单时间")])),_:1}),i(h,{class:"form-picker",mode:"date",value:O.orderDate,"default-value":new Date,onConfirm:oe},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(O.orderDate?B(O.orderDate):"请选择下单时间"),1)])),_:1})])),_:1},8,["value","default-value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("预计交货日期")])),_:1}),i(s,{class:"form-picker",mode:"date",value:O.expectedDelivery,onChange:se},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(O.expectedDelivery||"请选择预计交货日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("实际交货日期")])),_:1}),i(s,{class:"form-picker",mode:"date",value:O.actualDelivery,onChange:re},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(O.actualDelivery||"请选择实际交货日期"),1)])),_:1})])),_:1},8,["value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("订单总金额")])),_:1}),i(o,{type:"number",class:"form-input",placeholder:"请输入订单总金额",modelValue:O.totalAmount,"onUpdate:modelValue":a[1]||(a[1]=e=>O.totalAmount=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("货币代码")])),_:1}),i(o,{type:"text",class:"form-input",placeholder:"请输入货币代码",modelValue:O.currency,"onUpdate:modelValue":a[2]||(a[2]=e=>O.currency=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("折扣率")])),_:1}),i(o,{type:"number",class:"form-input",placeholder:"请输入折扣率",modelValue:O.discount,"onUpdate:modelValue":a[3]||(a[3]=e=>O.discount=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("税率")])),_:1}),i(o,{type:"number",class:"form-input",placeholder:"请输入税率",modelValue:O.taxRate,"onUpdate:modelValue":a[4]||(a[4]=e=>O.taxRate=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("税额")])),_:1}),i(o,{type:"number",class:"form-input",placeholder:"请输入税额",modelValue:O.taxAmount,"onUpdate:modelValue":a[5]||(a[5]=e=>O.taxAmount=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("订单总额")])),_:1}),i(o,{type:"number",class:"form-input",placeholder:"请输入订单总额",modelValue:O.grandTotal,"onUpdate:modelValue":a[6]||(a[6]=e=>O.grandTotal=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("付款条件")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:F.value,"range-key":"label",value:X.value,onChange:ue},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(X.value>=0?F.value[X.value].label:"请选择付款条件"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("支付状态")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:E.value,"range-key":"label",value:Z.value,onChange:me},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(Z.value>=0?E.value[Z.value].label:"请选择支付状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("订单状态")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:H.value,"range-key":"label",value:q.value,onChange:ne},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(q.value>=0?H.value[q.value].label:"请选择订单状态"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("收货地址")])),_:1}),i(o,{type:"text",class:"form-input",placeholder:"请输入收货地址",modelValue:O.shippingAddress,"onUpdate:modelValue":a[7]||(a[7]=e=>O.shippingAddress=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("运输方式")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:P.value,"range-key":"label",value:z.value,onChange:ce},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(z.value>=0?P.value[z.value].label:"请选择运输方式"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("物流单号")])),_:1}),i(o,{type:"text",class:"form-input",placeholder:"请输入物流单号",modelValue:O.trackingNo,"onUpdate:modelValue":a[8]||(a[8]=e=>O.trackingNo=e)},null,8,["modelValue"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("负责人")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:R.value,"range-key":"employeeName",value:J.value,onChange:de},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(J.value>=0?R.value[J.value].employeeName:"请选择负责人"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("操作员")])),_:1}),i(s,{class:"form-picker",mode:"selector",range:R.value,"range-key":"employeeName",value:W.value,onChange:ie},{default:u((()=>[i(t,{class:"picker-view"},{default:u((()=>[v(p(W.value>=0?R.value[W.value].employeeName:"请选择操作员"),1)])),_:1})])),_:1},8,["range","value"])])),_:1}),i(t,{class:"form-item"},{default:u((()=>[i(l,{class:"form-label"},{default:u((()=>[v("备注")])),_:1}),i(k,{class:"form-textarea",placeholder:"请输入备注",modelValue:O.notes,"onUpdate:modelValue":a[9]||(a[9]=e=>O.notes=e)},null,8,["modelValue"])])),_:1})])),_:1}),i(t,{class:"form-footer"},{default:u((()=>[i(D,{class:"form-btn cancel",onClick:ge},{default:u((()=>[v("取消")])),_:1}),i(D,{class:"form-btn confirm",onClick:pe},{default:u((()=>[v("提交")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-ae7816e9"]]);export{C as default};
